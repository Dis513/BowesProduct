<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Vector Editor Pro ‚Äì BowesProduct (Illustrator-style)</title>
  <style>
  *, *::before, *::after { box-sizing: border-box; }
  html, body { margin: 0; height: 100%; background: #020617; color: white; font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; overflow: hidden; -webkit-font-smoothing: antialiased; }
  
  /* ================= HEADER (logo + nav only) ================= */
  .site-header {
    position: sticky; top: 0; z-index: 1000; background: rgba(2,6,23,0.95); border-bottom: 1px solid #1e293b; backdrop-filter: blur(10px);
  }
  .header-inner { max-width: 1400px; margin: 0 auto; padding: 0.6rem 1rem; display: flex; align-items: center; justify-content: space-between; }
  .header-left { display: flex; align-items: center; gap: 1.6rem; }
  .logo a { font-size: 1.3rem; font-weight: 700; color: white; text-decoration: none; white-space: nowrap; }
  .main-nav { display: flex; gap: 1.4rem; }
  .main-nav a { color: #e5e7eb; text-decoration: none; font-size: 0.95rem; }
  .main-nav a:hover, .main-nav a.active { color: #60a5fa; }
  .header-right { display: flex; align-items: center; gap: 0.8rem; min-height: 44px; }
  #profilePic { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #60a5fa; object-fit: cover; display: none; }
  .login-btn { padding: 0.45rem 1.1rem; border-radius: 999px; border: 1.5px solid #60a5fa; background: transparent; color: #60a5fa; font-size: 0.95rem; cursor: pointer; }

  /* ================= APPLICATION MENU BAR (below header) ================= */
  .app-menu-bar {
    background: rgba(15,23,42,0.95); border-bottom: 1px solid #1e293b; padding: 4px 1rem; display: flex; gap: 2rem; font-size: 0.9rem; position: sticky; top: 70px; z-index: 999; backdrop-filter: blur(10px);
  }
  .menu-bar > div {
    position: relative; cursor: pointer; padding: 0.4rem 0.8rem;
  }
  .menu-bar > div:hover { color: #60a5fa; }
  .dropdown {
    position: absolute; top: 100%; left: 0; background: #0f172a; border: 1px solid #1e293b; min-width: 220px; display: none; flex-direction: column; box-shadow: 0 8px 20px rgba(0,0,0,0.5); border-radius: 8px; overflow: hidden;
  }
  .dropdown div {
    padding: 0.7rem 1rem; text-align: left; white-space: nowrap; transition: background 0.2s;
  }
  .dropdown div:hover { background: #1e293b; }
  .dropdown hr { border: none; border-top: 1px solid #1e293b; margin: 0.4rem 0; }
  .menu-bar > div:hover .dropdown { display: flex; }

  /* ================= MAIN LAYOUT ================= */
  #container { position: relative; width: 100%; height: 100%; padding-top: 110px; padding-bottom: 80px; }
  #canvas { display: block; width: 100%; height: 100%; background: #0a0a0a; touch-action: none; outline: none; }

  /* ================= LEFT TOOLBAR ================= */
  #floatingToolbar {
    position: fixed; left: 20px; top: 120px; background: rgba(30, 41, 59, 0.95); padding: 12px; border-radius: 12px; border: 1px solid #1e293b; backdrop-filter: blur(8px); z-index: 1150; display: flex; flex-direction: column; gap: 12px;
  }
  .tool-group { display: flex; flex-direction: column; gap: 4px; }
  .tool-btn {
    width: 44px; height: 44px; border-radius: 8px; border: 1px solid #475569; background: rgba(2, 6, 23, 0.8); color: #94a3b8; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; font-size: 1.4rem;
  }
  .tool-btn:hover { background: rgba(51, 65, 85, 1); color: white; }
  .tool-btn.active { color: #60a5fa; border-color: #60a5fa; background: rgba(2, 6, 23, 1); }

  /* ================= RIGHT PANEL ================= */
  .panel {
    position: absolute; top: 120px; right: 20px; width: 400px; max-height: calc(100vh - 260px); background: rgba(2, 6, 23, 0.95); border: 1px solid #1e293b; border-radius: 12px; padding: 1.5rem; overflow-y: auto; z-index: 20; backdrop-filter: blur(10px); transition: transform 0.3s ease; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  }
  .panel.hidden { transform: translateX(440px); }
  #panelToggle { position: absolute; left: -60px; top: 50%; transform: translateY(-50%); width: 60px; height: 110px; background: rgba(2, 6, 23, 0.98); border: 1px solid #1e293b; border-right: none; border-radius: 20px 0 0 20px; color: #60a5fa; font-size: 2.4rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 21; backdrop-filter: blur(12px); box-shadow: 0 6px 30px rgba(0,0,0,0.5); transition: all 0.3s ease; }
  #panelToggle:hover { background: rgba(30, 41, 59, 0.98); color: white; transform: translateY(-50%) translateX(-4px); }

  .panel h2 { color: #60a5fa; margin: 1.5rem 0 1rem; font-size: 1.1rem; border-bottom: 1px solid #1e293b; padding-bottom: 0.5rem; }
  .control-group { margin-bottom: 1.2rem; }
  label { display: block; font-size: 0.9rem; color: #e5e7eb; margin-bottom: 0.4rem; }
  input, select { width: 100%; padding: 0.5rem; border-radius: 0.375rem; border: 1px solid #1f2937; background: #020617; color: #e5e7eb; }
  input[type="range"] { accent-color: #60a5fa; }
  input[type="color"] { height: 44px; padding: 0.2rem; }
  button { background: #60a5fa; border: none; color: white; cursor: pointer; padding: 0.6rem; border-radius: 8px; font-weight: 600; transition: background 0.2s; }
  button:hover { background: #3b82f6; }

  .layer-item { display: flex; align-items: center; gap: 8px; padding: 8px; background: #0f172a; border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
  .layer-item.active { background: #1e293b; border: 1px solid #60a5fa; }

  /* Mobile & Footer */
  @media (max-width: 900px) {
    .panel { top: auto; bottom: 0; width: 100%; height: 85vh; max-height: none; border-radius: 20px 20px 0 0; transform: translateY(calc(100% - 60px)); }
    .panel.visible { transform: translateY(0); }
    #panelToggle { display: none; }
  }
  .site-footer { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(2,6,23,0.95); border-top: 1px solid #1e293b; padding: 1rem; z-index: 1000; backdrop-filter: blur(10px); }
  .footer-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1.5rem; font-size: 0.85rem; }
  #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #60a5fa; font-size: 1.5rem; font-weight: bold; pointer-events: none; }
  </style>
  <!-- Paper.js for vector editing -->
  <script src="https://cdn.jsdelivr.net/npm/paper@0.12.17/dist/paper-full.min.js"></script>
  <!-- Your existing ninja script -->
  <script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
<header class="site-header">
  <div class="header-inner">
    <div class="header-left">
      <div class="logo"><a href="index.html">BowesProduct</a></div>
      <nav class="main-nav">
        <a href="index.html">Home</a>
        <a href="models.html">Models</a>
        <a href="retexture.html">Retexture</a>
        <a href="editor.html" class="active">Editor</a>
      </nav>
    </div>
    <div class="header-right">
      <img id="profilePic" alt="Profile">
      <button id="authBtn" class="login-btn">Login</button>
    </div>
  </div>
</header>

<!-- Application Menu Bar BELOW header -->
<div class="app-menu-bar">
  <div class="menu-bar">
    <div>File
      <div class="dropdown">
        <div onclick="newDocument()">New</div>
        <div>Open...</div>
        <div>Save</div>
        <hr>
        <div onclick="exportSVG()">Export SVG</div>
        <div onclick="exportPNG()">Export PNG</div>
      </div>
    </div>
    <div>Edit
      <div class="dropdown">
        <div>Undo (Ctrl+Z)</div>
        <div>Redo (Ctrl+Y)</div>
        <hr>
        <div>Cut</div>
        <div>Copy</div>
        <div>Paste</div>
      </div>
    </div>
    <div>Object
      <div class="dropdown">
        <div>Group</div>
        <div>Ungroup</div>
        <hr>
        <div>Unite</div>
        <div>Minus Front</div>
      </div>
    </div>
    <div>View
      <div class="dropdown">
        <div>Zoom In</div>
        <div>Zoom Out</div>
        <div>Fit Artboard</div>
      </div>
    </div>
  </div>
</div>

<div id="container">
  <div id="loader">Vector Editor ‚Ä¢ Use tools to draw</div>
  <canvas id="canvas" resize></canvas>

  <!-- Left Toolbar -->
  <div id="floatingToolbar">
    <div class="tool-group">
      <div class="tool-btn active" id="selectTool" title="Selection (V)">‚¨ö</div>
      <div class="tool-btn" id="directSelectTool" title="Direct Selection (A)">‚Üñ</div>
    </div>
    <div class="tool-group">
      <div class="tool-btn" id="penTool" title="Pen (P)">‚úí</div>
      <div class="tool-btn" id="rectangleTool" title="Rectangle (M)">‚ñ°</div>
      <div class="tool-btn" id="typeTool" title="Type (T)">T</div>
      <div class="tool-btn" id="eyedropperTool" title="Eyedropper (I)">üíß</div>
    </div>
  </div>

  <!-- Right Panel -->
  <div class="panel visible" id="panel">
    <button id="panelToggle">‚Üê</button>

    <h2>Properties</h2>
    <div id="propertiesContent">Select an object</div>

    <h2>Layers</h2>
    <ol id="layersList">
      <li class="layer-item active">Layer 1</li>
    </ol>
    <button id="addLayerBtn">+ Add Layer</button>

    <h2>Appearance</h2>
    <div class="control-group">
      <label>Fill</label>
      <input type="color" id="fillColor" value="#ff0000">
    </div>
    <div class="control-group">
      <label>Stroke</label>
      <input type="color" id="strokeColor" value="#000000">
    </div>
    <div class="control-group">
      <label>Stroke Width <span id="strokeWidthVal">1</span></label>
      <input type="range" min="0" max="100" value="1" id="strokeWidth">
    </div>

    <h2>Export</h2>
    <button id="exportSVG">Export SVG</button>
    <button id="exportPNG">Export PNG</button>
  </div>
</div>

<footer class="site-footer">
  <div class="footer-inner">
    <nav class="footer-nav">
      <a href="about.html">About</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </nav>
    <p>¬© 2026 BowesProduct</p>
  </div>
</footer>

<div id="mobilePanelToggle"><span>‚ñ≤ Controls</span></div>

<!-- Firebase Auth (your original) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB4JMVBMcWcN2wKsaVYmnggHH5ue1mUfaA",
  authDomain: "bowesproduct.firebaseapp.com",
  projectId: "bowesproduct"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const authBtn = document.getElementById("authBtn");
const profilePic = document.getElementById("profilePic");
const levelInfo = document.getElementById("levelInfo");
const levelText = document.getElementById("levelText");
const xpBar = document.getElementById("xpBar");

authBtn.onclick = () => auth.currentUser ? signOut(auth) : signInWithPopup(auth, provider);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    authBtn.textContent = "Login";
    profilePic.style.display = "none";
    levelInfo.style.display = "none";
    return;
  }
  authBtn.textContent = "Logout";
  profilePic.src = user.photoURL || "";
  profilePic.style.display = "block";
  const ref = doc(db, "users", user.uid);
  let snap = await getDoc(ref);
  if (!snap.exists()) {
    await setDoc(ref, { xp: 10 });
    snap = await getDoc(ref);
  }
  const xp = snap.data().xp || 0;
  const levels = [0, 200, 500, 1000, 2000];
  let level = levels.filter(v => xp >= v).length - 1;
  let next = levels[level + 1] ?? levels[level];
  let progress = next === levels[level] ? 100 : ((xp - levels[level]) / (next - levels[level])) * 100;
  levelText.textContent = `Level ${level} ‚Ä¢ ${xp} XP`;
  xpBar.style.width = progress + "%";
  levelInfo.style.display = "block";
});
</script>

<!-- Paper.js Vector Editor -->
<script type="text/paperscript" canvas="canvas">
var tools = {};
var currentTool;
var currentPath;
var fillColor = '#ff0000';
var strokeColor = '#000000';
var strokeWidth = 1;

function activateTool(name) {
  currentTool = tools[name];
  currentTool.activate();
  document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(name + 'Tool').classList.add('active');
}

// Selection Tool
tools.select = new Tool();
tools.select.onMouseDrag = function(event) {
  if (project.selectedItems.length) {
    project.selectedItems.forEach(item => item.position += event.delta);
  }
  updateProperties();
};

// Pen Tool
tools.pen = new Tool();
tools.pen.onMouseDown = function(event) {
  currentPath = new Path({ strokeColor: strokeColor, strokeWidth: strokeWidth });
  currentPath.add(event.point);
};
tools.pen.onMouseDrag = function(event) {
  currentPath.add(event.point);
  currentPath.smooth();
};
tools.pen.onMouseUp = function() {
  currentPath.simplify();
  currentPath.closed = true;
  currentPath.fillColor = fillColor;
  currentPath.selected = true;
};

// Rectangle Tool
tools.rectangle = new Tool();
tools.rectangle.onMouseDrag = function(event) {
  if (currentPath) currentPath.remove();
  var rect = new Rectangle(event.downPoint, event.point);
  currentPath = new Path.Rectangle(rect);
  currentPath.fillColor = fillColor;
  currentPath.strokeColor = strokeColor;
  currentPath.strokeWidth = strokeWidth;
};
tools.rectangle.onMouseUp = function() {
  currentPath.selected = true;
};

// Type Tool
tools.type = new Tool();
tools.type.onMouseDown = function(event) {
  var text = new PointText(event.point);
  text.content = 'Edit me';
  text.fillColor = fillColor;
  text.fontSize = 32;
  text.selected = true;
};

// Eyedropper
tools.eyedropper = new Tool();
tools.eyedropper.onMouseDown = function(event) {
  var hit = project.hitTest(event.point);
  if (hit && hit.item) {
    if (hit.type === 'fill' && hit.item.fillColor) {
      fillColor = hit.item.fillColor.toCSS(true);
      document.getElementById('fillColor').value = fillColor;
    }
    if (hit.type === 'stroke' && hit.item.strokeColor) {
      strokeColor = hit.item.strokeColor.toCSS(true);
      document.getElementById('strokeColor').value = strokeColor;
    }
  }
};

// Bind tools
document.getElementById('selectTool').onclick = () => activateTool('select');
document.getElementById('penTool').onclick = () => activateTool('pen');
document.getElementById('rectangleTool').onclick = () => activateTool('rectangle');
document.getElementById('typeTool').onclick = () => activateTool('type');
document.getElementById('eyedropperTool').onclick = () => activateTool('eyedropper');

// Default
activateTool('select');

// Controls sync
document.getElementById('fillColor').oninput = e => {
  fillColor = e.target.value;
  if (project.selectedItems.length) project.selectedItems.forEach(i => i.fillColor = fillColor);
};
document.getElementById('strokeColor').oninput = e => {
  strokeColor = e.target.value;
  if (project.selectedItems.length) project.selectedItems.forEach(i => i.strokeColor = strokeColor);
};
document.getElementById('strokeWidth').oninput = e => {
  strokeWidth = parseFloat(e.target.value);
  document.getElementById('strokeWidthVal').textContent = strokeWidth;
  if (project.selectedItems.length) project.selectedItems.forEach(i => i.strokeWidth = strokeWidth);
};

// Properties
function updateProperties() {
  var item = project.selectedItems[0];
  document.getElementById('propertiesContent').innerHTML = item 
    ? `<p>Type: ${item.className}</p><p>Position: ${item.position.x.toFixed(0)}, ${item.position.y.toFixed(0)}</p>`
    : 'No selection';
}
project.on('selectionchanged', updateProperties);

// Export
function exportSVG() {
  var svg = project.exportSVG({asString: true});
  var blob = new Blob([svg], {type: 'image/svg+xml'});
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url; a.download = 'artwork.svg'; a.click();
}
function exportPNG() {
  var data = view.element.toDataURL('image/png');
  var a = document.createElement('a');
  a.href = data; a.download = 'artwork.png'; a.click();
}
function newDocument() { project.clear(); }

document.getElementById('loader').style.display = 'none';
</script>

<script>
// Panel toggle
const panel = document.getElementById('panel');
const panelToggle = document.getElementById('panelToggle');
const mobileToggle = document.getElementById('mobilePanelToggle');
let visible = true;
const toggle = () => {
  visible = !visible;
  panel.classList.toggle('hidden', !visible);
  panel.classList.toggle('visible', visible);
  panelToggle.textContent = visible ? '‚Üê' : '‚Üí';
  mobileToggle.querySelector('span').textContent = visible ? '‚ñº Hide' : '‚ñ≤ Controls';
};
panelToggle.onclick = toggle;
mobileToggle.onclick = toggle;
</script>
</body>
</html>
