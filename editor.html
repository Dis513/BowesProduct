<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Vector Editor Pro – BowesProduct (Illustrator 2026)</title>
  <style>
  *, *::before, *::after { box-sizing: border-box; }
  html, body { margin: 0; height: 100%; background: #020617; color: white; font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; overflow: hidden; -webkit-font-smoothing: antialiased; }
  
  /* ================= HEADER (logo + nav only) ================= */
  .site-header {
    position: sticky; top: 0; z-index: 1000; background: rgba(2,6,23,0.95); border-bottom: 1px solid #1e293b; backdrop-filter: blur(10px);
  }
  .header-inner { max-width: 1400px; margin: 0 auto; padding: 0.6rem 1rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; }
  .header-left { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; }
  .logo a { font-size: 1.3rem; font-weight: 700; color: white; text-decoration: none; white-space: nowrap; }
  .main-nav { display: flex; gap: 1rem; flex-wrap: wrap; }
  .main-nav a { color: #e5e7eb; text-decoration: none; font-size: 0.9rem; white-space: nowrap; }
  .main-nav a:hover, .main-nav a.active { color: #60a5fa; }
  .header-right { display: flex; align-items: center; gap: 0.8rem; min-height: 44px; flex-wrap: wrap; }
  #profilePic { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #60a5fa; object-fit: cover; display: none; }
  .login-btn { padding: 0.45rem 1.1rem; border-radius: 999px; border: 1.5px solid #60a5fa; background: transparent; color: #60a5fa; font-size: 0.95rem; cursor: pointer; }
  #levelInfo { display: none; font-size: 0.8rem; color: #cbd5e1; }
  #levelText { white-space: nowrap; font-size: 0.75rem; }
  #xpOuter { width: 100px; height: 5px; background: #1e293b; border-radius: 3px; margin-top: 4px; }
  #xpBar { height: 100%; width: 0%; background: #60a5fa; border-radius: 3px; transition: width 0.35s ease; }

  @media (max-width: 900px) {
    .header-inner { padding: 0.5rem; }
    .header-left { width: 100%; justify-content: space-between; }
    .main-nav { gap: 0.8rem; order: 3; width: 100%; }
    .main-nav a { font-size: 0.85rem; }
    .header-right { width: 100%; justify-content: space-between; }
    #levelInfo { flex: 1; }
    #xpOuter { width: 100%; }
  }

  /* ================= APPLICATION MENU BAR ================= */
.app-menu-bar {
  background: rgba(15,23,42,0.98);
  border-bottom: 1px solid #1e293b;
  padding: 0;
  padding-left: 150px; /* Nice moderate left indent — matches left toolbar feel */
  display: flex;
  gap: 0;
  font-size: 0.85rem;
  position: sticky;
  top: 70px;
  z-index: 999;
  backdrop-filter: blur(10px);
  flex-wrap: wrap;
  height: 36px;
  align-items: center;
}
  .menu-bar { display: flex; height: 100%; }
  .menu-bar > div {
    position: relative; cursor: pointer; padding: 0.5rem 1rem; height: 100%; display: flex; align-items: center; user-select: none;
  }
  .menu-bar > div:hover { color: #60a5fa; background: rgba(96, 165, 250, 0.1); }
  .dropdown {
    position: absolute; top: 100%; left: 0; background: #0f172a; border: 1px solid #1e293b; min-width: 260px; display: none; flex-direction: column; box-shadow: 0 8px 25px rgba(0,0,0,0.6); border-radius: 6px; overflow: hidden; z-index: 10000; margin-top: 2px;
  }
  .dropdown div { padding: 0.6rem 1.2rem; text-align: left; white-space: nowrap; transition: background 0.15s; font-size: 0.85rem; cursor: pointer; }
  .dropdown div:hover { background: #1e293b; }
  .dropdown div:active { background: #334155; }
  .dropdown .shortcut { float: right; color: #64748b; font-size: 0.75rem; margin-left: 2rem; }
  .dropdown hr { border: none; border-top: 1px solid #1e293b; margin: 0.4rem 0; }
  .dropdown .submenu { position: absolute; left: 100%; top: 0; min-width: 220px; display: none; }
  .dropdown div:hover .submenu { display: flex; }
  .menu-bar > div:hover .dropdown, .dropdown:hover { display: flex; }

  /* ================= MAIN LAYOUT ================= */
  #container { position: relative; width: 100%; height: 100%; padding-top: 106px; padding-bottom: 0; display: flex; }
  
  /* ================= CANVAS AREA ================= */
  #canvas-container {
    flex: 1; position: relative; background: #0a0a0a; overflow: hidden; display: flex; flex-direction: column;
  }
  
  /* Rulers */
  .ruler { position: absolute; background: #1e293b; color: #64748b; font-size: 10px; z-index: 10; }
  .ruler-h { top: 0; left: 60px; right: 0; height: 20px; border-bottom: 1px solid #334155; }
  .ruler-v { top: 20px; left: 0; width: 60px; bottom: 0; border-right: 1px solid #334155; }
  .ruler-corner { position: absolute; top: 0; left: 0; width: 60px; height: 20px; background: #1e293b; border-right: 1px solid #334155; border-bottom: 1px solid #334155; z-index: 11; }
  
  #canvas { display: block; width: 100%; height: 100%; touch-action: none; outline: none; margin-top: 20px; margin-left: 60px; background: #0a0a0a; }
  
  /* Artboard */
  .artboard {
    position: absolute; background: white; box-shadow: 0 0 0 1px #334155, 0 4px 20px rgba(0,0,0,0.5);
  }
  .artboard-label {
    position: absolute; bottom: -25px; left: 0; color: #64748b; font-size: 11px; white-space: nowrap;
  }

  /* ================= LEFT TOOLBAR ================= */
  #floatingToolbar {
    position: fixed; left: 20px; top: 116px; background: rgba(30, 41, 59, 0.95); padding: 10px; border-radius: 12px; border: 1px solid #1e293b; backdrop-filter: blur(8px); z-index: 1150; display: flex; flex-direction: column; gap: 8px; max-height: calc(100vh - 180px); overflow-y: auto;
  }
  .tool-group { display: flex; flex-direction: column; gap: 2px; padding: 4px 0; border-bottom: 1px solid #1e293b; }
  .tool-group:last-child { border-bottom: none; }
  .tool-btn {
    width: 42px; height: 42px; border-radius: 6px; border: 1px solid transparent; background: transparent; color: #94a3b8; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.15s; font-size: 1.3rem; position: relative;
  }
  .tool-btn:hover { background: rgba(51, 65, 85, 1); color: white; }
  .tool-btn.active { color: #60a5fa; background: rgba(96, 165, 250, 0.1); border-color: #60a5fa; }

  /* ================= RIGHT PANEL DOCK ================= */
  .panel-dock {
    position: fixed; right: 20px; top: 116px; width: 320px; max-height: calc(100vh - 140px); background: rgba(2, 6, 23, 0.95); border: 1px solid #1e293b; border-radius: 12px; overflow: hidden; z-index: 20; backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); display: flex; flex-direction: column;
  }
  
  #dockToggle { 
    position: absolute; left: -50px; top: 50%; transform: translateY(-50%); width: 50px; height: 100px; background: rgba(2, 6, 23, 0.98); border: 1px solid #1e293b; border-right: none; border-radius: 12px 0 0 12px; color: #60a5fa; font-size: 2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 21; backdrop-filter: blur(12px); box-shadow: 0 6px 30px rgba(0,0,0,0.5); transition: all 0.3s ease;
  }
  #dockToggle:hover { background: rgba(30, 41, 59, 0.98); color: white; transform: translateY(-50%) translateX(-4px); }

  .panel-tabs { display: flex; background: #0f172a; border-bottom: 1px solid #1e293b; overflow-x: auto; position: relative; }
  .panel-tab {
    padding: 0.6rem 1rem; background: transparent; border: none; color: #94a3b8; cursor: pointer; font-size: 0.8rem; white-space: nowrap; transition: all 0.2s; flex-shrink: 0;
  }
  .panel-tab:hover { color: #e5e7eb; }
  .panel-tab.active { color: #60a5fa; background: rgba(96, 165, 250, 0.1); border-bottom: 2px solid #60a5fa; }
  .panel-close-btn {
    position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 28px; height: 28px; border-radius: 6px; border: 1px solid #334155; background: #1e293b; color: #94a3b8; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: all 0.2s;
  }
  .panel-close-btn:hover { background: #334155; color: #e5e7eb; }

  .panel-content { padding: 1rem; overflow-y: auto; flex: 1; }
  .panel-section { display: none; }
  .panel-section.active { display: block; }

  .panel-section h3 { 
    color: #60a5fa; margin: 1rem 0 0.8rem; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid #1e293b; padding-bottom: 0.4rem; font-weight: 600;
  }
  .panel-section h3:first-child { margin-top: 0; }

  .control-group { margin-bottom: 1rem; }
  .control-group label { display: block; font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.4rem; }
  .control-row { display: flex; gap: 0.5rem; align-items: center; }
  
  input[type="text"], input[type="number"], select {
    width: 100%; padding: 0.4rem 0.6rem; border-radius: 4px; border: 1px solid #334155; background: #0f172a; color: #e5e7eb; font-size: 0.85rem;
  }
  input[type="text"]:focus, input[type="number"]:focus, select:focus { outline: none; border-color: #60a5fa; }
  
  input[type="range"] { width: 100%; accent-color: #60a5fa; }
  input[type="color"] { width: 100%; height: 36px; padding: 2px; border: 1px solid #334155; border-radius: 4px; background: #0f172a; cursor: pointer; }
  
  .btn {
    padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid #334155; background: #1e293b; color: #e5e7eb; cursor: pointer; font-size: 0.85rem; transition: all 0.2s;
  }
  .btn:hover { background: #334155; border-color: #475569; }
  .btn-primary { background: #60a5fa; border-color: #60a5fa; color: white; }
  .btn-primary:hover { background: #3b82f6; border-color: #3b82f6; }
  .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.75rem; }
  .btn-group { display: flex; gap: 0.25rem; }
  .btn-group .btn { flex: 1; }

  /* Layers Panel */
  .layer-item { 
    display: flex; align-items: center; gap: 8px; padding: 0.5rem; background: #0f172a; border-radius: 6px; margin-bottom: 0.4rem; cursor: pointer; transition: all 0.15s;
  }
  .layer-item:hover { background: #1e293b; }
  .layer-item.active { background: #1e293b; border: 1px solid #60a5fa; }
  .layer-item .layer-icon { width: 20px; text-align: center; font-size: 0.9rem; }
  .layer-item .layer-name { flex: 1; font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .layer-item .layer-actions { display: flex; gap: 4px; }
  .layer-item .layer-actions button { padding: 2px 6px; font-size: 0.75rem; }

  /* Appearance Panel */
  .appearance-item { 
    padding: 0.6rem; background: #0f172a; border-radius: 6px; margin-bottom: 0.4rem; display: flex; align-items: center; gap: 0.5rem;
  }
  .appearance-item .type { font-size: 0.75rem; color: #64748b; width: 40px; }
  .appearance-item .color-preview { width: 24px; height: 24px; border-radius: 4px; border: 1px solid #334155; }
  .appearance-item .value { flex: 1; font-size: 0.8rem; }

  /* Swatches */
  .swatch-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; }
  .swatch { 
    width: 100%; aspect-ratio: 1; border-radius: 4px; cursor: pointer; border: 1px solid #334155; transition: all 0.15s;
  }
  .swatch:hover { transform: scale(1.1); }
  .swatch.selected { border: 2px solid #60a5fa; }

  /* Alignment */
  .align-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; }
  .align-btn { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border: 1px solid #334155; background: #0f172a; border-radius: 4px; cursor: pointer; transition: all 0.15s; }
  .align-btn:hover { background: #1e293b; }

  /* Status Bar */
  .status-bar {
    position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15, 23, 42, 0.95); border-top: 1px solid #1e293b; padding: 0.4rem 1rem; font-size: 0.75rem; color: #64748b; display: flex; justify-content: space-between; z-index: 1000; backdrop-filter: blur(10px);
  }
  .status-bar .left { display: flex; gap: 2rem; }
  .status-bar .right { display: flex; gap: 1rem; }

  /* Mobile */
  @media (max-width: 900px) {
    #floatingToolbar { 
      left: 10px; top: 111px; padding: 6px; max-height: calc(100vh - 160px);
    }
    .tool-btn { width: 38px; height: 38px; font-size: 1.1rem; }
    .panel-dock { 
      top: auto; 
      bottom: 0; 
      right: 0; 
      left: 0; 
      width: 100%; 
      height: 40vh;
      max-height: 40vh;
      border-radius: 12px 12px 0 0; 
      transform: none; 
      z-index: 2000;
      overflow-y: auto;
    }
    .panel-dock.hidden { transform: translateY(100%); }
    .panel-dock.visible { transform: translateY(0); }
    #dockToggle { 
      display: flex; 
      top: -50px; 
      left: 50%; 
      transform: translateX(-50%); 
      width: 100px; 
      height: 50px; 
      border-radius: 12px 12px 0 0; 
    }
    .ruler-h { left: 50px; }
    .ruler-v { display: none; }
    #canvas { margin-left: 50px; }
    .app-menu-bar { gap: 1rem; padding-left: 60px; z-index: 999; }
    .menu-bar > div { padding: 0.3rem 0.5rem; font-size: 0.8rem; }
    .status-bar { z-index: 1100; }
    .dropdown { z-index: 1900; }
  }

  /* Panel Backdrop/Overlay - DISABLED on mobile for canvas visibility */
  .panel-backdrop {
    display: none !important;
  }

  /* Tool/Panel Name Notification */
  .tool-notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    background: linear-gradient(135deg, rgba(96, 165, 250, 0.95), rgba(59, 130, 246, 0.95));
    color: white;
    padding: 1.5rem 2.5rem;
    border-radius: 16px;
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    z-index: 10000;
    pointer-events: none;
    opacity: 0;
    box-shadow: 0 20px 60px rgba(96, 165, 250, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .tool-notification.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  .tool-notification.hide {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.9);
  }

  #loader { 
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #60a5fa; font-size: 1.2rem; font-weight: 600; pointer-events: none; z-index: 5;
  }

  /* Context Menu */
  .context-menu {
    position: fixed; background: #0f172a; border: 1px solid #1e293b; min-width: 180px; border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.5); z-index: 2000; display: none;
  }
  .context-menu div { padding: 0.6rem 1rem; cursor: pointer; font-size: 0.85rem; }
  .context-menu div:hover { background: #1e293b; }
  .context-menu hr { border: none; border-top: 1px solid #1e293b; margin: 0.3rem 0; }
  </style>
  <!-- Paper.js for vector editing -->
  <script src="https://cdn.jsdelivr.net/npm/paper@0.12.17/dist/paper-full.min.js"></script>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
<!-- Your full HTML structure here (header, menu bar, panels, etc. - unchanged) -->
<!-- ... (omitted for brevity, copy from your original) ... -->

<!-- Paper.js Vector Editor -->
<script type="text/paperscript" canvas="canvas">
// IMPORTANT: This script runs in Paper.js scope
console.log('Paper.js script starting...');

// Global state
var tools = {};
var currentTool;
var fillColor = new Color('#ff0000');
var strokeColor = new Color('#000000');
var strokeWidth = 1;
var currentPath;
var isDrawing = false;
var startPoint;
var currentShape;
var clipboard = null;
var undoStack = [];
var redoStack = [];
var showGrid = false;
var showRulers = true;
var snapToGrid = false;
var gridSize = 20;
var layers = [];
var currentLayerIndex = 0;
var zoomLevel = 1;

console.log('Paper.js initialized, view size:', view.size);

// Initialize layers
function initLayers() {
  layers = [
    { name: 'Layer 1', visible: true, locked: false, items: [] }
  ];
  console.log('Layers initialized:', layers);
  updateLayersList();
}

// Tool/Panel Notification System
var notificationTimeout;

function showToolNotification(text) {
  var notification = document.getElementById('toolNotification');
  
  if (notificationTimeout) {
    clearTimeout(notificationTimeout);
  }
  
  notification.classList.remove('show', 'hide');
  notification.textContent = text;
  
  requestAnimationFrame(function() {
    notification.classList.add('show');
  });
  
  notificationTimeout = setTimeout(function() {
    notification.classList.remove('show');
    notification.classList.add('hide');
  }, 1500);
}

// Tool activation
function activateTool(name) {
  if (tools[name]) {
    currentTool = tools[name];
    currentTool.activate();
    console.log('Tool activated:', name);
    document.querySelectorAll('.tool-btn').forEach(function(b) { b.classList.remove('active'); });
    var btn = document.getElementById(name + 'Tool');
    if (btn) btn.classList.add('active');
    
    var toolNames = {
      'select': 'Selection Tool',
      'directSelect': 'Direct Selection Tool',
      'pen': 'Pen Tool',
      'pencil': 'Pencil Tool',
      'brush': 'Brush Tool',
      'rectangle': 'Rectangle Tool',
      'ellipse': 'Ellipse Tool',
      'polygon': 'Polygon Tool',
      'star': 'Star Tool',
      'line': 'Line Tool',
      'type': 'Type Tool',
      'typeOnPath': 'Type on Path Tool',
      'touchType': 'Touch Type Tool',
      'shapeBuilder': 'Shape Builder Tool',
      'perspectiveGrid': 'Perspective Grid Tool',
      'freeTransform': 'Free Transform Tool',
      'eyedropper': 'Eyedropper Tool',
      'measure': 'Measure Tool',
      'hand': 'Hand Tool',
      'zoom': 'Zoom Tool'
    };
    
    var statusTool = document.getElementById('statusTool');
    if (statusTool && toolNames[name]) {
      statusTool.textContent = toolNames[name];
    }
    
    if (toolNames[name]) {
      showToolNotification(toolNames[name]);
    }
  } else {
    console.warn('Tool not found:', name);
  }
}

/* All your tool definitions (select, pen, rectangle, etc.) remain the same - no modern syntax was used there */

/* ... (rest of your tool code unchanged) ... */

// Update properties panel
function updateProperties() {
  var item = project.selectedItems[0];
  var propX = document.getElementById('propX');
  var propY = document.getElementById('propY');
  var propW = document.getElementById('propW');
  var propH = document.getElementById('propH');
  var propRotation = document.getElementById('propRotation');
  var propShear = document.getElementById('propShear');
  var propOpacity = document.getElementById('propOpacity');
  var propBlendMode = document.getElementById('propBlendMode');
  
  if (item) {
    if (propX) propX.value = Math.round(item.position.x);
    if (propY) propY.value = Math.round(item.position.y);
    if (propW) propW.value = Math.round(item.bounds.width);
    if (propH) propH.value = Math.round(item.bounds.height);
    if (propRotation) propRotation.value = Math.round(item.rotation);
    if (propShear) propShear.value = Math.round(item.shear ? item.shear.x : 0);
    if (propOpacity) propOpacity.value = (item.opacity || 1) * 100;
    if (propBlendMode) propBlendMode.value = item.blendMode || 'normal';
    
    var statusSelection = document.getElementById('statusSelection');
    if (statusSelection) {
      statusSelection.textContent = item.className + ' selected';
    }
  } else {
    if (propX) propX.value = '';
    if (propY) propY.value = '';
    if (propW) propW.value = '';
    if (propH) propH.value = '';
    if (propRotation) propRotation.value = '';
    if (propShear) propShear.value = '';
    
    var statusSelection = document.getElementById('statusSelection');
    if (statusSelection) {
      statusSelection.textContent = 'No selection';
    }
  }
}

/* The rest of your functions (undo, redo, export, newDocument, etc.) are unchanged */

/* Initialize */
console.log('Initializing layers...');
initLayers();
console.log('Activating selection tool...');
activateTool('select');
console.log('Saving initial state...');
saveState();
console.log('Paper.js setup complete!');

// Hide loader after a short delay
view.onFrame = function(event) {
  if (event.count === 10) {
    var loader = document.getElementById('loader');
    if (loader) {
      loader.style.display = 'none';
      console.log('Loader hidden, editor ready!');
    }
  }
};

// Expose functions to global scope for HTML onclick handlers
window.newDocument = newDocument;
window.saveDocument = saveDocument;
window.saveDocumentAs = saveDocumentAs;
window.handleOpen = handleOpen;
window.handlePlace = handlePlace;
window.exportSVG = exportSVG;
window.exportPNG = exportPNG;
window.exportPDF = exportPDF;
window.undo = undo;
window.redo = redo;
window.cut = cut;
window.copy = copy;
window.paste = paste;
window.duplicate = duplicate;
window.deleteSelection = deleteSelection;
window.selectAll = selectAll;
window.deselectAll = deselectAll;
window.groupSelection = groupSelection;
window.ungroupSelection = ungroupSelection;
window.lockSelection = lockSelection;
window.unlockAll = unlockAll;
window.bringToFront = bringToFront;
window.sendToBack = sendToBack;
window.bringForward = bringForward;
window.sendBackward = sendBackward;
window.rotateSelection = rotateSelection;
window.flipSelection = flipSelection;
window.showTransformDialog = showTransformDialog;
window.pathfinder = pathfinder;
window.createOutlines = createOutlines;
window.findFont = findFont;
window.selectSameFill = selectSameFill;
window.selectSameStroke = selectSameStroke;
window.selectSameStrokeWidth = selectSameStrokeWidth;
window.zoomIn = zoomIn;
window.zoomOut = zoomOut;
window.zoomToFit = zoomToFit;
window.zoomTo100 = zoomTo100;
window.toggleGrid = toggleGrid;
window.toggleRulers = toggleRulers;
window.toggleSnap = toggleSnap;
window.showPanel = showPanel;
window.updateTransform = updateTransform;
window.updateOpacity = updateOpacity;
window.updateBlendMode = updateBlendMode;
window.convertToPoint = convertToPoint;
window.convertToCurve = convertToCurve;
window.addLayer = addLayer;
window.deleteLayer = deleteLayer;
window.addFill = addFill;
window.addStroke = addStroke;
window.addSwatch = addSwatch;
window.clearSwatches = clearSwatches;
window.setGradientType = setGradientType;
window.updateStroke = updateStroke;
window.setStrokeCap = setStrokeCap;
window.setStrokeJoin = setStrokeJoin;
window.align = align;
window.distribute = distribute;
window.updateTypography = updateTypography;
window.setFontStyle = setFontStyle;
window.setTextAlign = setTextAlign;

</script>


<script>
// Panel tab switching
document.querySelectorAll('.panel-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.panel-section').forEach(s => s.classList.remove('active'));
    
    this.classList.add('active');
    document.getElementById('panel-' + this.dataset.panel).classList.add('active');
  });
});

// Dock toggle
const dock = document.getElementById('panelDock');
const dockToggle = document.getElementById('dockToggle');
const panelCloseBtn = document.getElementById('panelCloseBtn');
const panelBackdrop = document.getElementById('panelBackdrop');
let dockVisible = true;

function toggleDock() {
  dockVisible = !dockVisible;
  dock.classList.toggle('visible', dockVisible);
  dock.classList.toggle('hidden', !dockVisible);
  dockToggle.textContent = dockVisible ? '◀' : '▶';
}

dockToggle.onclick = toggleDock;
if (panelCloseBtn) {
  panelCloseBtn.onclick = toggleDock;
}

// Show specific panel
function showPanel(panelName) {
  document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel-section').forEach(s => s.classList.remove('active'));
  
  var tab = document.querySelector('.panel-tab[data-panel="' + panelName + '"]');
  if (tab) tab.classList.add('active');
  
  var section = document.getElementById('panel-' + panelName);
  if (section) section.classList.add('active');
  
  // Show dock if hidden
  if (!dockVisible) {
    dock.classList.add('visible');
    dock.classList.remove('hidden');
    dockVisible = true;
    dockToggle.textContent = '◀';
  }
  
  // Show notification with panel name
  var panelNames = {
    'properties': 'Properties Panel',
    'layers': 'Layers Panel',
    'appearance': 'Appearance Panel',
    'swatches': 'Swatches Panel',
    'gradient': 'Gradient Panel',
    'stroke': 'Stroke Panel',
    'align': 'Align Panel',
    'character': 'Character Panel',
    'paragraph': 'Paragraph Panel'
  };
  
  if (panelNames[panelName]) {
    showToolNotification(panelNames[panelName]);
  }
}

// Gradient controls
document.getElementById('gradientAngle').addEventListener('input', function() {
  document.getElementById('gradientAngleVal').textContent = this.value + '°';
});

// Stroke controls
document.getElementById('strokeWeight').addEventListener('input', function() {
  document.getElementById('strokeWeightVal').textContent = this.value + ' px';
});

// Window resize handler
window.addEventListener('resize', function() {
  if (window.innerWidth > 900) {
    // On desktop, always show dock
    dock.classList.add('visible');
    dock.classList.remove('hidden');
    dockVisible = true;
  }
});

// Swatches
const defaultSwatches = [
  '#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff',
  '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9', '#6c5ce7', '#fd79a8',
  '#e17055', '#00b894', '#0984e3', '#6c5ce7', '#fdcb6e', '#636e72', '#2d3436', '#b2bec3'
];

function initSwatches() {
  const swatchGrid = document.getElementById('swatchGrid');
  if (!swatchGrid) return;
  
  swatchGrid.innerHTML = '';
  defaultSwatches.forEach(color => {
    const swatch = document.createElement('div');
    swatch.className = 'swatch';
    swatch.style.backgroundColor = color;
    swatch.onclick = function() {
      if (window.project && window.project.selectedItems && window.project.selectedItems.length) {
        window.project.selectedItems.forEach(item => {
          item.fillColor = color;
        });
      }
    };
    swatchGrid.appendChild(swatch);
  });
}

// Appearance panel functions
function addFill() {
  // Add new fill appearance item
  const appearanceList = document.getElementById('appearanceList');
  if (appearanceList) {
    const item = document.createElement('div');
    item.className = 'appearance-item';
    item.innerHTML = `
      <span class="type">Fill</span>
      <div class="color-preview" style="background-color: #ff0000"></div>
      <span class="value">#ff0000</span>
    `;
    appearanceList.appendChild(item);
  }
}

function addStroke() {
  const appearanceList = document.getElementById('appearanceList');
  if (appearanceList) {
    const item = document.createElement('div');
    item.className = 'appearance-item';
    item.innerHTML = `
      <span class="type">Stroke</span>
      <div class="color-preview" style="background-color: #000000"></div>
      <span class="value">#000000</span>
    `;
    appearanceList.appendChild(item);
  }
}

// Stroke panel functions
function setStrokeCap(cap) {
  if (window.project && window.project.selectedItems && window.project.selectedItems.length) {
    window.project.selectedItems.forEach(item => {
      item.strokeCap = cap;
    });
  }
}

function setStrokeJoin(join) {
  if (window.project && window.project.selectedItems && window.project.selectedItems.length) {
    window.project.selectedItems.forEach(item => {
      item.strokeJoin = join;
    });
  }
}

function updateStroke() {
  const weight = parseFloat(document.getElementById('strokeWeight').value);
  const dash = document.getElementById('strokeDash').value;
  const color = document.getElementById('strokeColorInput').value;
  
  if (window.project && window.project.selectedItems && window.project.selectedItems.length) {
    window.project.selectedItems.forEach(item => {
      item.strokeWidth = weight;
      if (dash) {
        const dashArray = dash.split(',').map(d => parseFloat(d.trim()));
        item.dashArray = dashArray;
      } else {
        item.dashArray = [];
      }
      item.strokeColor = color;
    });
  }
}

// Align functions
function align(alignment) {
  if (!window.project || !window.project.selectedItems || window.project.selectedItems.length < 2) return;
  
  const items = window.project.selectedItems;
  const bounds = items.map(item => item.bounds);
  
  switch(alignment) {
    case 'left':
      items.forEach(item => item.position.x = bounds[0].left);
      break;
    case 'right':
      items.forEach(item => item.position.x = bounds[0].right - (item.bounds.width / 2));
      break;
    case 'top':
      items.forEach(item => item.position.y = bounds[0].top);
      break;
    case 'bottom':
      items.forEach(item => item.position.y = bounds[0].bottom - (item.bounds.height / 2));
      break;
    case 'center-h':
      items.forEach(item => item.position.x = bounds[0].center.x);
      break;
    case 'center-v':
      items.forEach(item => item.position.y = bounds[0].center.y);
      break;
  }
}

function distribute(distribution) {
  if (!project || !project.selectedItems || project.selectedItems.length < 3) return;
  
  const items = project.selectedItems;
  // Simplified distribution - would need more complex calculation for proper distribution
  alert('Distribute feature - arrange items evenly');
}

// Typography functions
function updateTypography() {
  if (!window.project || !window.project.selectedItems || window.project.selectedItems.length === 0) return;
  
  const fontFamily = document.getElementById('fontFamily').value;
  const fontSize = parseInt(document.getElementById('fontSize').value);
  const lineHeight = parseInt(document.getElementById('lineHeight').value);
  const letterSpacing = parseInt(document.getElementById('letterSpacing').value);
  
  window.project.selectedItems.forEach(item => {
    if (item instanceof PointText) {
      item.fontFamily = fontFamily;
      item.fontSize = fontSize;
      item.leading = lineHeight;
      // item.letterSpacing = letterSpacing; // May need different property name
    }
  });
}

function setFontStyle(style) {
  if (!window.project || !window.project.selectedItems || window.project.selectedItems.length === 0) return;
  
  window.project.selectedItems.forEach(item => {
    if (item instanceof PointText) {
      switch(style) {
        case 'bold':
          item.fontWeight = 'bold';
          break;
        case 'italic':
          item.fontStyle = 'italic';
          break;
        case 'underline':
          // Text decoration not directly available in Paper.js
          break;
      }
    }
  });
}

function setTextAlign(align) {
  if (!window.project || !window.project.selectedItems || window.project.selectedItems.length === 0) return;
  
  window.project.selectedItems.forEach(item => {
    if (item instanceof PointText) {
      item.justification = align;
    }
  });
}

// Swatch functions
function addSwatch() {
  const color = prompt('Enter hex color:', '#000000');
  if (color && /^#[0-9A-Fa-f]{6}$/.test(color)) {
    defaultSwatches.push(color);
    initSwatches();
  }
}

function clearSwatches() {
  if (confirm('Clear all custom swatches?')) {
    defaultSwatches.length = 8; // Keep original 8
    initSwatches();
  }
}

// Gradient functions
function setGradientType(type) {
  // Would implement gradient application to selected items
  alert('Gradient type: ' + type);
}

// Transform dialog
function showTransformDialog() {
  alert('Transform dialog - coming soon!');
}

// Initialize swatches on load
window.onload = function() {
  initSwatches();
  addFill();
  addStroke();
  
  // Set initial backdrop state on mobile
  if (window.innerWidth <= 900 && dockVisible) {
    panelBackdrop.classList.add('visible');
  }
};

// Mobile touch support for position tracking
document.addEventListener('DOMContentLoaded', function() {
  var canvas = document.getElementById('canvas');
  if (canvas) {
    canvas.addEventListener('touchmove', function(e) {
      if (e.touches.length > 0) {
        var touch = e.touches[0];
        var rect = canvas.getBoundingClientRect();
        var x = touch.clientX - rect.left;
        var y = touch.clientY - rect.top;
        var statusPosition = document.getElementById('statusPosition');
        if (statusPosition) {
          statusPosition.textContent = 'X: ' + Math.round(x) + ' Y: ' + Math.round(y);
        }
      }
    }, { passive: true });
  }
});

// Mobile touch support
document.addEventListener('touchstart', function(e) {
  // Prevent default touch behaviors that might interfere with drawing
  if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON') {
    // e.preventDefault(); // Commented out to allow scrolling
  }
}, { passive: false });
</script>
</body>
</html>
