<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Image Editor ‚Äì BowesProduct</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  *, *::before, *::after { box-sizing: border-box; }
  html, body {
    margin: 0; background: #020617; color: white;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    overflow: hidden; height: 100%;
  }
  /* Header style similar to example page */
  .site-header {
    position: sticky; top: 0; z-index: 1000;
    background: rgba(2,6,23,0.95);
    border-bottom: 1px solid #1e293b;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0.6rem 1rem;
  }
  .header-inner {
    display: flex; align-items: center; justify-content: space-between; width: 100%;
  }
  .logo a { color: white; font-size: 1.3rem; font-weight: 700; text-decoration: none; }
  .main-nav { display: flex; gap: 1.4rem; margin-left: 1rem; }
  .main-nav a { color: #e5e7eb; text-decoration: none; font-size: 0.95rem; }
  .main-nav a:hover, .main-nav a.active { color: #60a5fa; }

  /* Main container with canvas and controls */
  #container {
    position: relative; width: 100%; height: calc(100vh - 70px);
    display: flex; flex-direction: row;
  }

  /* Canvas styling */
  #canvas {
    width: 100%; height: 100%;
    display: block; touch-action: none; outline: none;
  }

  /* Toolbar styles */
  .canvas-toolbar {
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 0.5rem; background: rgba(30,41,59,0.8); padding: 0.5rem 1rem; border-radius: 10px;
    z-index: 10;
  }
  .toolbar-btn {
    background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 0.6rem 1rem; font-size: 0.9rem; color: #fff; cursor: pointer;
    transition: all 0.2s;
  }
  .toolbar-btn:hover { background: #334155; }

  /* Effects panel styling */
  .panel {
    position: absolute; top: 70px; right: 20px; width: 350px; max-height: calc(100vh - 90px);
    background: rgba(2,6,23,0.95); border: 1px solid #1e293b; border-radius: 12px; padding: 1rem; overflow-y: auto; z-index: 9;
    backdrop-filter: blur(10px);
  }
  .panel h3 { margin-top: 0; }
  @media(max-width: 768px) {
    #container { flex-direction: column; height: auto; }
    .panel { top: auto; right: 0; width: 100%; max-height: 40vh; border-radius: 12px 12px 0 0; }
  }
</style>
</head>
<body>
<header class="site-header">
  <div class="header-inner">
    <div style="display:flex; align-items:center;">
      <div class="logo"><a href="#">BowesProduct</a></div>
      <nav class="main-nav">
        <a href="index.html">Home</a>
        <a href="models.html">Models</a>
        <a href="retexture.html" class="active">Retexture</a>
        <a href="editor.html" class="active">Editor</a>
      </nav>
    </div>
  </div>
</header>

<div id="container">
  <canvas id="canvas"></canvas>
  <!-- Effects Panel -->
  <div class="panel" id="effectsPanel">
    <h3>Effects</h3>
    <button class="toolbar-btn" onclick="loadTab('basic')">Basic</button>
    <button class="toolbar-btn" onclick="loadTab('color')">Color</button>
    <button class="toolbar-btn" onclick="loadTab('blur')">Blur</button>
    <button class="toolbar-btn" onclick="loadTab('stylize')">Stylize</button>
    <button class="toolbar-btn" onclick="loadTab('artistic')">Artistic</button>
    <button class="toolbar-btn" onclick="loadTab('distort')">Distort</button>
    <div id="panelContent" style="margin-top:1rem;">Select a tab to see controls</div>
  </div>
  <!-- Toolbar buttons -->
  <div class="canvas-toolbar">
    <button class="toolbar-btn primary" onclick="loadImage()">üìÅ Upload</button>
    <button class="toolbar-btn" id="undoBtn" disabled>‚Ü© Undo</button>
    <button class="toolbar-btn" id="redoBtn" disabled>‚Ü™ Redo</button>
    <button class="toolbar-btn" id="resetBtn" disabled>‚Ü∫ Reset</button>
    <button class="toolbar-btn primary" id="exportBtn" disabled>üíæ Export</button>
  </div>
</div>

<script>
// ------------------- Core Variables -------------------
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let originalImage = null;
let isImageLoaded = false;
let undoStack = [];
let redoStack = [];
const maxUndo = 20;

const effects = {
  brightness: 0,
  contrast: 0,
  exposure: 0,
  hueRotate: 0,
  saturation: 0,
  lightness: 0,
  blur: 0,
  motionAngle: 0,
  motionAmount: 0,
  vignette: 0
};

// ------------------- Load Image -------------------
function loadImage() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = () => {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        originalImage = img;
        resizeCanvasToImage(img);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        undoStack = [];
        redoStack = [];
        saveState();
        applyEffects();
        document.getElementById('resetBtn').disabled = false;
        document.getElementById('exportBtn').disabled = false;
        document.getElementById('undoBtn').disabled = false;
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  };
  input.click();
}

function resizeCanvasToImage(img) {
  const maxW = Math.min(800, window.innerWidth - 40);
  const maxH = Math.min(600, window.innerHeight - 200);
  let w = img.width;
  let h = img.height;
  if (w > maxW) {
    h = (maxW / w) * h;
    w = maxW;
  }
  if (h > maxH) {
    w = (maxH / h) * w;
    h = maxH;
  }
  canvas.width = w;
  canvas.height = h;
}

// ------------------- Undo/Redo/Reset -------------------
function saveState() {
  if (isImageLoaded) {
    undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
    if (undoStack.length > maxUndo) undoStack.shift();
    document.getElementById('undoBtn').disabled = undoStack.length <= 1;
  }
}
document.getElementById('undoBtn').onclick = () => {
  if (undoStack.length > 1) {
    redoStack.push(undoStack.pop());
    ctx.putImageData(undoStack[undoStack.length - 1], 0, 0);
    document.getElementById('redoBtn').disabled = false;
    if (undoStack.length <= 1) document.getElementById('undoBtn').disabled = true;
  }
};
document.getElementById('redoBtn').onclick = () => {
  if (redoStack.length > 0) {
    undoStack.push(redoStack.pop());
    ctx.putImageData(undoStack[undoStack.length - 1], 0, 0);
    document.getElementById('undoBtn').disabled = false;
    if (redoStack.length === 0) document.getElementById('redoBtn').disabled = true;
  }
};
document.getElementById('resetBtn').onclick = () => {
  if (originalImage) {
    resizeCanvasToImage(originalImage);
    ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
    saveState();
    applyEffects();
  }
};

// ------------------- Load Tabs & Effects -------------------
function loadTab(tab) {
  const content = document.getElementById('panelContent');
  if (tab === 'basic') {
    content.innerHTML = `
      <div>
        <label>Brightness</label>
        <input type="range" min="-50" max="50" value="${effects.brightness}" data-param="brightness" onchange="updateEffect(this)">
        <div>Value: <span id="value-brightness">${effects.brightness}</span></div>
      </div>
      <div>
        <label>Contrast</label>
        <input type="range" min="-50" max="50" value="${effects.contrast}" data-param="contrast" onchange="updateEffect(this)">
        <div>Value: <span id="value-contrast">${effects.contrast}</span></div>
      </div>
      <div>
        <label>Exposure</label>
        <input type="range" min="-2" max="2" step="0.1" value="${effects.exposure}" data-param="exposure" onchange="updateEffect(this)">
        <div>Value: <span id="value-exposure">${effects.exposure}</span></div>
      </div>
    `;
  }
  if (tab === 'color') {
    content.innerHTML = `
      <div>
        <label>Hue Rotate</label>
        <input type="range" min="-180" max="180" value="${effects.hueRotate}" data-param="hueRotate" onchange="updateEffect(this)">
        <div>Value: <span id="value-hueRotate">${effects.hueRotate}</span></div>
      </div>
      <div>
        <label>Saturation</label>
        <input type="range" min="-100" max="100" value="${effects.saturation}" data-param="saturation" onchange="updateEffect(this)">
        <div>Value: <span id="value-saturation">${effects.saturation}</span></div>
      </div>
    `;
  }
  if (tab === 'blur') {
    content.innerHTML = `
      <div>
        <label>Blur</label>
        <input type="range" min="0" max="20" value="${effects.blur}" data-param="blur" onchange="updateEffect(this)">
        <div>Value: <span id="value-blur">${effects.blur}</span></div>
      </div>
    `;
  }
}

// ------------------- Update Effects -------------------
function updateEffect(elem) {
  const param = elem.dataset.param;
  let val = parseFloat(elem.value);
  document.getElementById('value-' + param).textContent = val;
  effects[param] = val;
  applyEffects();
}

// ------------------- Apply Effects -------------------
function applyEffects() {
  if (!originalImage) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.filter = `
    brightness(${1 + effects.brightness / 100})
    contrast(${1 + effects.contrast / 100})
    brightness(${1 + effects.exposure / 2})
    hue-rotate(${effects.hueRotate}deg)
    saturate(${effects.saturation + 100}%)
  `.replace(/\s+/g, ' ').trim();

  ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
  ctx.filter = 'none';

  // Vignette overlay
  if (effects.vignette > 0) {
    const gradient = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height)/2);
    gradient.addColorStop(0, 'rgba(0,0,0,0)');
    gradient.addColorStop(1, `rgba(0,0,0,${effects.vignette/100})`);
    ctx.globalCompositeOperation = 'multiply';
    ctx.fillStyle = gradient;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.globalCompositeOperation = 'source-over';
  }
}

// ------------------- Initialize -------------------
loadTab('basic');
</script>
</body>
</html>
