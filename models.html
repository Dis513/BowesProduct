<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Models Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.5.0/dist/model-viewer.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="theme-emerald">

<header>
  <div class="header-inner">
    <div class="logo"><a href="index.html">Home</a></div>
    <nav class="main-nav">
      <a href="index.html">Home</a>
      <a href="#viewer" class="active">Models</a>
    </nav>
  </div>
</header>

<section id="viewer">
  <h2 style="text-align:center;">3D Model Viewer</h2>
  <div class="model-container">
    <model-viewer id="mainViewer" src="models/werewolf.glb" alt="3D Model" shadow-intensity="1" auto-rotate camera-controls>
      <div slot="progress-bar" class="progress-message">Loading model…</div>
    </model-viewer>
  </div>
</section>

<section id="models" class="models-grid">
  <h2>Available Models</h2>
  <div class="grid">
    <div class="grid-item" data-model="models/werewolf.glb" data-product="prod_TfDrG6YjEzxBiO">
      Werewolf
      <button class="btn-view">View Model</button>
      <button class="btn-price">10€</button>
    </div>
    <div class="grid-item" data-model="models/zombiewerewolf.glb" data-product="prod_TfDskIkgjdC2N7">
      Zombie Werewolf
      <button class="btn-view">View Model</button>
      <button class="btn-price">10€</button>
    </div>
    <div class="grid-item" data-model="models/giantbunny.glb" data-product="prod_TfDtH0eDaAAlxu">
      Giant Bunny
      <button class="btn-view">View Model</button>
      <button class="btn-price">10€</button>
    </div>
    <div class="grid-item" data-model="models/giantskeletonbunny.glb" data-product="prod_TfDuZyHjnZYoCP">
      Giant Skeleton Bunny
      <button class="btn-view">View Model</button>
      <button class="btn-price">10€</button>
    </div>
  </div>
</section>

<footer>
  <div class="footer-inner">&copy; 2025 3D Models Viewer</div>
</footer>

<script src="https://js.stripe.com/v3/"></script>
<script>
const viewer = document.getElementById('mainViewer');
const stripe = Stripe("pk_test_51ShTSuCP7Y0gyZEAYn4KfGpkzlWrTc59lcOZCPSn77p9GuVIgHQ24tVy2HMGkYcejD7JfvFbRFGle3CKfyEPJm4500Xcgi5Cv7");

document.querySelectorAll('.grid-item').forEach(item => {
  const viewBtn = item.querySelector('.btn-view');
  const priceBtn = item.querySelector('.btn-price');

  viewBtn.addEventListener('click', () => {
    viewer.setAttribute('src', item.dataset.model);
    viewer.reload();
    window.scrollTo({ top: viewer.offsetTop - 80, behavior: 'smooth' });
  });

  priceBtn.addEventListener('click', async () => {
    const productId = item.dataset.product;
    try {
      const res = await fetch("/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ productId })
      });
      const data = await res.json();
      if (data.sessionId) stripe.redirectToCheckout({ sessionId: data.sessionId });
      else alert("Failed to create checkout session.");
    } catch (err) {
      console.error(err);
      alert("Error connecting to server.");
    }
  });
});
</script>

</body>
</html>
