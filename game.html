<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOULS NIGHTMARE - Rhythm Game</title>
    <link id="theme-stylesheet" rel="stylesheet" href="styles.css">
    <!-- Google Fonts for Dark Souls Theme -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB4JMVBMcWcN2wKsaVYmnggHH5ue1mUfaA",
  authDomain: "bowesproduct.firebaseapp.com",
  projectId: "bowesproduct"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

// Make Firebase available globally
window.firebaseAuth = auth;
window.firebaseDb = db;
window.firebaseProvider = provider;
window.firebaseDocs = { doc, getDoc, setDoc, updateDoc, collection, query, orderBy, limit, getDocs };
    </script>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <!-- Background Effects -->
    <div class="void-background"></div>
    <div class="fog-layer"></div>
    
    <!-- Parallax Background Layers -->
    <div class="parallax-layer layer-1" id="parallaxLayer1">
        <div class="star-field"></div>
    </div>
    <div class="parallax-layer layer-2" id="parallaxLayer2">
        <div class="distant-mountains"></div>
    </div>
    <div class="parallax-layer layer-3" id="parallaxLayer3">
        <div class="mid-landscape"></div>
    </div>
    <div class="parallax-layer layer-4" id="parallaxLayer4">
        <div class="foreground-elements"></div>
    </div>
    
    <!-- Beat-reactive glow effect -->
    <div class="beat-glow" id="beatGlow"></div>
    
    <!-- Particles -->
    <div class="particles" id="particles"></div>
    
    <!-- Decorative Elements -->
    <div class="crooked-tree left"></div>
    <div class="crooked-tree right"></div>

    <!-- Main Menu -->
    <div class="menu-container" id="mainMenu">
        <!-- Player Profile Display -->
        <div class="player-profile" id="playerProfile">
            <div class="profile-icon" id="profileIcon">
                <img id="profilePic" class="profile-img" style="display: none;" alt="Profile">
                <span class="profile-emoji" id="profileEmoji">üé∏</span>
            </div>
            <div class="player-info">
                <div class="player-level">
                    <span class="level-label">LVL</span>
                    <span class="level-number" id="playerLevel">1</span>
                </div>
                <div class="player-xp">
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpFill"></div>
                    </div>
                    <span class="xp-text" id="xpText">0 / 100 XP</span>
                </div>
            </div>
            <button class="auth-button" id="authBtn">Login</button>
        </div>

        <h1 class="game-title">NEON NIGHTMARE</h1>
        <p class="game-subtitle">A Rhythm Experience</p>
        
        <div class="menu-options">
            <div class="file-upload-container">
                <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                <button class="menu-button" id="uploadButton">
                    üéµ Upload Audio File
                </button>
                <p class="upload-info" id="uploadInfo">Supports MP3, WAV, OGG, M4A</p>
            </div>
            <button class="menu-button" id="selectLevel">
                üéÆ Select Level
            </button>
            <button class="menu-button" id="viewLeaderboards">
                üèÜ High Scores
            </button>
            <button class="menu-button" id="openSettings">
                ‚öôÔ∏è Settings
            </button>
            <button class="menu-button" id="openThemes">
                üé® Themes
            </button>
        </div>
    </div>

    <!-- Theme Select Modal -->
    <div class="pause-menu" id="themeMenu" style="display: none;">
        <h2 class="pause-title">üé® THEMES & UNLOCKABLES</h2>
        <div class="theme-list">
            <div class="theme-option" data-theme="neon" id="neon-theme">
                <div class="theme-preview neon-preview"></div>
                <div class="theme-info">
                    <h3>Neon Nightmare</h3>
                    <p>Neon Cyberpunk Theme</p>
                </div>
                <button class="theme-select-btn">‚úì Selected</button>
            </div>
            <div class="theme-option" data-theme="dark-souls" id="dark-souls-theme">
                <div class="theme-preview dark-souls-preview"></div>
                <div class="theme-info">
                    <h3>Dark Souls</h3>
                    <p>üîí Unlock at 1000 points</p>
                </div>
                <button class="theme-select-btn" disabled>üîí Locked</button>
            </div>
        </div>
        <div class="unlock-progress">
            <h3>Unlock Progress</h3>
            <p>Current High Score: <span id="unlockScore">0</span>/1000</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        <button class="menu-button" id="closeThemes">‚Üê Back</button>
    </div>

    <!-- Level Select Modal -->
    <div class="pause-menu" id="levelSelectMenu">
        <h2 class="pause-title">üéØ SELECT LEVEL</h2>
        
        <!-- Game Mode Selection -->
        <div class="mode-selection">
            <button class="mode-button active" data-mode="single">üéÆ Single Player</button>
            <button class="mode-button" data-mode="multiplayer">‚öîÔ∏è Multiplayer PvP</button>
        </div>
        
        <!-- Single Player Level Grid -->
        <div class="single-player-content">
            <div class="level-grid" id="levelGrid"></div>
        </div>
        
        <!-- Multiplayer Lobby Content -->
        <div class="multiplayer-content" style="display: none;">
            <div class="lobby-section">
                <h3>üèÜ Competitive Play</h3>
                <div class="lobby-options">
                    <button class="menu-button" id="createLobby">
                        üéØ Create Lobby
                    </button>
                    <button class="menu-button" id="joinLobby">
                        üîç Join Lobby
                    </button>
                    <button class="menu-button" id="quickMatch">
                        ‚ö° Quick Match
                    </button>
                </div>
                
                <!-- Create Lobby Section -->
                <div class="lobby-create" id="lobbyCreate" style="display: none;">
                    <h4>Create New Lobby</h4>
                    <div class="lobby-settings">
                        <label>Lobby Name:</label>
                        <input type="text" id="lobbyName" placeholder="My Epic Battle" maxlength="20">
                        
                        <label>Difficulty:</label>
                        <select id="lobbyDifficulty">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                            <option value="expert">Expert</option>
                            <option value="master">Master</option>
                        </select>
                        
                        <label>Song Type:</label>
                        <select id="lobbySongType">
                            <option value="random">Random Song</option>
                            <option value="custom">Custom Upload</option>
                        </select>
                    </div>
                    <div class="lobby-actions">
                        <button class="menu-button" id="confirmCreateLobby">Create Lobby</button>
                        <button class="menu-button secondary" id="cancelCreateLobby">Cancel</button>
                    </div>
                </div>
                
                <!-- Join Lobby Section -->
                <div class="lobby-join" id="lobbyJoin" style="display: none;">
                    <h4>Available Lobbies</h4>
                    <div class="lobby-list" id="lobbyList">
                        <div class="lobby-item">
                            <div class="lobby-info">
                                <span class="lobby-name">Loading lobbies...</span>
                                <span class="lobby-status">üîÑ</span>
                            </div>
                        </div>
                    </div>
                    <div class="lobby-actions">
                        <button class="menu-button secondary" id="cancelJoinLobby">Back</button>
                    </div>
                </div>
                
                <!-- Lobby Waiting Room -->
                <div class="lobby-waiting" id="lobbyWaiting" style="display: none;">
                    <h4>Waiting for Opponent...</h4>
                    <div class="waiting-info">
                        <div class="lobby-code">
                            <label>Lobby Code:</label>
                            <span id="currentLobbyCode">XXXXXX</span>
                        </div>
                        <div class="lobby-players">
                            <div class="player-slot">
                                <div class="player-avatar">üé∏</div>
                                <span class="player-name">You</span>
                                <span class="player-status ready">Ready</span>
                            </div>
                            <div class="player-slot empty" id="opponentSlot">
                                <div class="player-avatar">‚ùì</div>
                                <span class="player-name">Waiting...</span>
                                <span class="player-status waiting">‚è≥</span>
                            </div>
                        </div>
                    </div>
                    <div class="waiting-actions">
                        <button class="menu-button secondary" id="leaveLobby">Leave Lobby</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="menu-options">
            <button class="menu-button" id="backToMainMenu">
                ‚Üê Back to Menu
            </button>
        </div>
    </div>

    <!-- Cutscene Player -->
    <div class="cutscene-container" id="cutsceneContainer">
        <video id="cutsceneVideo" class="cutscene-video"></video>
        <button class="skip-button" id="skipCutscene">SKIP ‚è≠Ô∏è</button>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="gameContainer">
        <!-- Level Indicator -->
        <div class="level-indicator" id="levelIndicator">
            <span class="level-label">LEVEL</span>
            <span class="level-number" id="levelNumber">1</span>
        </div>

        <!-- Character -->
        <div class="character" id="character">
            <div class="character-sprite" id="characterSprite">
                <div class="character-body"></div>
                <div class="character-eyes">
                    <div class="eye left"></div>
                    <div class="eye right"></div>
                </div>
                <div class="character-aura" id="characterAura"></div>
            </div>
            <div class="character-shadow"></div>
        </div>

        <!-- Top HUD -->
        <div class="hud-top">
            <div class="score-display">
                SCORE: <span id="scoreValue">0</span>
            </div>
        </div>

        <!-- Side Health Bars -->
        <div class="side-health-bars">
            <div class="side-health-bar left" id="leftHealthBar">
                <div class="health-fill" id="leftHealthFill"></div>
                <div class="health-text">HP</div>
            </div>
            <div class="side-health-bar right" id="rightHealthBar">
                <div class="health-fill" id="rightHealthFill"></div>
                <div class="health-text">HP</div>
            </div>
        </div>

        <!-- Song Info -->
        <div class="song-info">
            <h2 class="song-title" id="songTitle">No Track Loaded</h2>
            <p class="song-artist" id="songArtist">Select a level to begin</p>
        </div>

        <!-- Note Highway -->
        <div class="note-highway" id="noteHighway">
            <div class="fret-lanes">
                <div class="fret-lane" data-fret="green"></div>
                <div class="fret-lane" data-fret="red"></div>
                <div class="fret-lane" data-fret="yellow"></div>
                <div class="fret-lane" data-fret="blue"></div>
                <div class="fret-lane" data-fret="orange"></div>
            </div>
            <div class="target-line" id="targetLine"></div>
        </div>

        <!-- Fret Buttons -->
        <div class="fret-buttons">
            <div class="fret-button green" data-fret="green">
                <span>A</span>
                <span class="fret-button-key">Green</span>
            </div>
            <div class="fret-button red" data-fret="red">
                <span>S</span>
                <span class="fret-button-key">Red</span>
            </div>
            <div class="fret-button yellow" data-fret="yellow">
                <span>D</span>
                <span class="fret-button-key">Yellow</span>
            </div>
            <div class="fret-button blue" data-fret="blue">
                <span>F</span>
                <span class="fret-button-key">Blue</span>
            </div>
            <div class="fret-button orange" data-fret="orange">
                <span>G</span>
                <span class="fret-button-key">Orange</span>
            </div>
        </div>

        <!-- Bottom HUD -->
        <div class="hud-bottom">
            <div class="combo-multiplier-container">
                <div class="combo-display" id="comboDisplay">
                    <span id="comboValue">0</span> COMBO
                </div>
                <div class="combo-bar-container">
                    <div class="combo-bar" id="comboBar">
                        <div class="combo-bar-fill" id="comboBarFill"></div>
                    </div>
                </div>
                <div class="multiplier-container">
                    <div class="multiplier-pulse" id="multiplierPulse">
                        <div class="multiplier-label">MULTIPLIER</div>
                        <div class="multiplier-display">
                            <span id="multiplierValue">1</span>x
                        </div>
                    </div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
    </div>

    <!-- Pause Menu -->
    <div class="pause-menu" id="pauseMenu">
        <h2 class="pause-title">‚è∏Ô∏è PAUSED</h2>
        <div class="menu-options">
            <button class="menu-button" id="resumeGame">
                ‚ñ∂Ô∏è Resume
            </button>
            <button class="menu-button" id="restartSong">
                üîÑ Restart
            </button>
            <button class="menu-button" id="returnToMenu">
                üè† Main Menu
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="pause-menu" id="settingsMenu">
        <h2 class="pause-title">‚öôÔ∏è SETTINGS</h2>
        <div class="menu-options">
            <button class="menu-button" id="setDifficultyEasy">
                üü¢ Easy
            </button>
            <button class="menu-button" id="setDifficultyMedium">
                üü° Medium
            </button>
            <button class="menu-button" id="setDifficultyHard">
                üü† Hard
            </button>
            <button class="menu-button" id="setDifficultyExpert">
                üî¥ Expert
            </button>
            <button class="menu-button" id="setDifficultyMaster">
                üü£ Master
            </button>
            <button class="menu-button" id="closeSettings">
                ‚Üê Back
            </button>
        </div>
    </div>

    <!-- Song Complete Modal -->
    <div class="pause-menu" id="songCompleteMenu">
        <h2 class="pause-title">üéµ LEVEL COMPLETE!</h2>
        <div class="menu-options">
            <div class="final-score">
                <p class="score-label">Final Score</p>
                <p class="score-value" id="finalScoreValue">0</p>
            </div>
            <div class="final-stats">
                <p>Perfect: <span id="perfectCount">0</span></p>
                <p>Great: <span id="greatCount">0</span></p>
                <p>Good: <span id="goodCount">0</span></p>
                <p>Miss: <span id="missCount">0</span></p>
                <p>Max Combo: <span id="maxComboValue">0</span></p>
            </div>
            <button class="menu-button" id="playAgain">
                üîÑ Play Again
            </button>
            <button class="menu-button" id="nextLevel">
                ‚ñ∂Ô∏è Next Level
            </button>
            <button class="menu-button" id="uploadNewSong">
                üìÅ Upload New Song
            </button>
            <button class="menu-button" id="selectLevelFromComplete">
                üìã Select Level
            </button>
            <button class="menu-button" id="mainMenuFromComplete">
                üè† Main Menu
            </button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="pause-menu" id="gameOverMenu">
        <h2 class="pause-title game-over-title">üíÄ TRACK FAILED</h2>
        <div class="menu-options">
            <div class="final-score">
                <p class="score-label">Final Score</p>
                <p class="score-value" id="gameOverScoreValue">0</p>
            </div>
            <button class="menu-button" id="restartFromGameOver">
                üîÑ Restart
            </button>
            <button class="menu-button" id="uploadFromGameOver">
                üìÅ Upload a File
            </button>
            <button class="menu-button" id="mainMenuFromGameOver">
                üè† Main Menu
            </button>
        </div>
    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 class="loading-title" id="loadingTitle">Loading...</h2>
            <p class="loading-text" id="loadingText">Please wait</p>
            <div class="loading-bar">
                <div class="loading-fill" id="loadingFill"></div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div class="pause-menu" id="leaderboardMenu">
        <h2 class="pause-title">üèÜ HIGH SCORES</h2>
        <div class="leaderboard-content">
            <div class="leaderboard-tabs">
                <button class="leaderboard-tab active" data-difficulty="all">All</button>
                <button class="leaderboard-tab" data-difficulty="easy">Easy</button>
                <button class="leaderboard-tab" data-difficulty="medium">Medium</button>
                <button class="leaderboard-tab" data-difficulty="hard">Hard</button>
                <button class="leaderboard-tab" data-difficulty="expert">Expert</button>
                <button class="leaderboard-tab" data-difficulty="master">Master</button>
            </div>
            <div class="leaderboard-list" id="leaderboardList">
                <!-- Leaderboard entries will be populated here -->
            </div>
        </div>
        <div class="menu-options">
            <button class="menu-button" id="closeLeaderboard">
                ‚Üê Back
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="game.js"></script>
    <script>
        // Make game instance globally available for onclick handlers
        let game;
        document.addEventListener('DOMContentLoaded', () => {
            game = new NeonNightmare();
        });
    </script>
</body>
</html>