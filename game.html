<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tactical Breach – BowesProduct</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*, *::before, *::after { box-sizing: border-box; }
html, body {
  margin: 0;
  background: #020617;
  color: white;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  overflow-x: hidden;
}
/* ================= HEADER ================= */
.site-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(2,6,23,0.95);
  border-bottom: 1px solid #1e293b;
}
.header-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0.6rem 1rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.header-left {
  display: flex;
  align-items: center;
  gap: 1.6rem;
}
.logo a {
  font-size: 1.3rem;
  font-weight: 700;
  color: white;
  text-decoration: none;
  white-space: nowrap;
}
.main-nav {
  display: flex;
  gap: 1.4rem;
}
.main-nav a {
  color: #e5e7eb;
  text-decoration: none;
  font-size: 0.95rem;
}
.main-nav a:hover { color:#60a5fa; }
.header-right {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  min-height: 44px;
}
#profilePic {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid #60a5fa;
  object-fit: cover;
  display: none;
}
.login-btn {
  padding: 0.45rem 1.1rem;
  border-radius: 999px;
  border: 1.5px solid #60a5fa;
  background: transparent;
  color: #60a5fa;
  font-size: 0.95rem;
  cursor: pointer;
}
#levelInfo {
  display: none;
  width: 140px;
  font-size: 0.8rem;
  color: #cbd5e1;
}
#levelText {
  white-space: nowrap;
}
#xpOuter {
  width: 100%;
  height: 5px;
  background: #1e293b;
  border-radius: 3px;
  margin-top: 4px;
}
#xpBar {
  height: 100%;
  width: 0%;
  background: #60a5fa;
  border-radius: 3px;
  transition: width 0.35s ease;
}
@media (max-width: 768px) {
  .header-inner {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }
  .header-left {
    justify-content: space-between;
  }
  .header-right {
    justify-content: space-between;
    width: 100%;
  }
  #levelInfo {
    width: 100%;
  }
}
/* ================= GAME STYLES ================= */
#game-container {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
}
#game-canvas {
  display: block;
  width: 100%;
  height: 100%;
}
#start-screen {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #020617 0%, #1e293b 50%, #0f172a 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
  cursor: pointer;
}
.start-content {
  text-align: center;
  z-index: 1;
  padding: 2rem;
  animation: fadeIn 1s ease-out;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.game-title {
  font-size: 4rem;
  font-weight: 900;
  color: #60a5fa;
  text-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
  margin-bottom: 0.5rem;
  letter-spacing: -2px;
}
.game-subtitle {
  font-size: 1.5rem;
  color: #94a3b8;
  margin-bottom: 2rem;
}
.start-hint {
  font-size: 1.2rem;
  color: #60a5fa;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
.controls-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-top: 2rem;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}
.control-item {
  background: rgba(30, 41, 59, 0.8);
  padding: 0.8rem 1.2rem;
  border-radius: 8px;
  border: 1px solid #334155;
  text-align: left;
}
.control-key {
  font-weight: 700;
  color: #60a5fa;
  margin-right: 0.5rem;
}
.control-desc {
  color: #cbd5e1;
  font-size: 0.9rem;
}
#hud {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  display: none;
}
#crosshair {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 20px;
  height: 20px;
}
.crosshair-dot {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 4px;
  height: 4px;
  background: white;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}
.crosshair-line {
  position: absolute;
  background: rgba(255, 255, 255, 0.8);
}
.crosshair-top {
  width: 2px;
  height: 8px;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
}
.crosshair-bottom {
  width: 2px;
  height: 8px;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
}
.crosshair-left {
  width: 8px;
  height: 2px;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
}
.crosshair-right {
  width: 8px;
  height: 2px;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
}
#hitmarker {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 30px;
  height: 30px;
  opacity: 0;
  pointer-events: none;
}
.hitmarker-line {
  position: absolute;
  background: #ef4444;
  height: 2px;
  width: 12px;
}
.hitmarker-tl {
  top: 30%;
  left: 30%;
  transform: rotate(-45deg);
}
.hitmarker-tr {
  top: 30%;
  right: 30%;
  transform: rotate(45deg);
}
.hitmarker-bl {
  bottom: 30%;
  left: 30%;
  transform: rotate(45deg);
}
.hitmarker-br {
  bottom: 30%;
  right: 30%;
  transform: rotate(-45deg);
}
@keyframes hitmarkerAnim {
  0% { opacity: 1; }
  100% { opacity: 0; }
}
#health-bar-container {
  position: absolute;
  bottom: 30px;
  left: 30px;
  width: 300px;
}
.health-bar-label {
  color: #60a5fa;
  font-size: 0.8rem;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.health-bar-bg {
  width: 100%;
  height: 8px;
  background: rgba(30, 41, 59, 0.8);
  border-radius: 4px;
  overflow: hidden;
}
.health-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, #60a5fa 0%, #3b82f6 100%);
  width: 100%;
  transition: width 0.3s ease, background 0.3s ease;
  border-radius: 4px;
}
.health-bar-fill.critical {
  background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
}
.health-bar-fill.warning {
  background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
}
#health-text {
  color: white;
  font-size: 1.5rem;
  font-weight: 700;
  margin-top: 4px;
}
#ammo-display {
  position: absolute;
  bottom: 30px;
  right: 30px;
  text-align: right;
}
.ammo-label {
  color: #60a5fa;
  font-size: 0.8rem;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 1px;
}
#ammo-current {
  color: white;
  font-size: 3rem;
  font-weight: 900;
}
#ammo-max {
  color: #64748b;
  font-size: 1.5rem;
  font-weight: 700;
}
#objective-panel {
  position: absolute;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(2, 6, 23, 0.9);
  border: 1px solid #334155;
  border-radius: 8px;
  padding: 1rem 2rem;
  text-align: center;
}
.objective-title {
  color: #60a5fa;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 4px;
}
#objective-text {
  color: white;
  font-size: 1.2rem;
  font-weight: 600;
}
#bomb-timer {
  color: #ef4444;
  font-size: 2rem;
  font-weight: 900;
  margin-top: 4px;
  display: none;
}
#minimap {
  position: absolute;
  top: 30px;
  right: 30px;
  width: 200px;
  height: 200px;
  background: rgba(2, 6, 23, 0.9);
  border: 2px solid #334155;
  border-radius: 8px;
  overflow: hidden;
}
#minimap-canvas {
  width: 100%;
  height: 100%;
}
#score-panel {
  position: absolute;
  top: 30px;
  left: 30px;
  text-align: left;
}
.score-item {
  margin-bottom: 0.5rem;
}
.score-label {
  color: #60a5fa;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.score-value {
  color: white;
  font-size: 1.5rem;
  font-weight: 700;
}
.damage-number {
  position: absolute;
  color: white;
  font-size: 1.2rem;
  font-weight: 900;
  text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.8);
  pointer-events: none;
  animation: floatUp 1s ease-out forwards;
}
.damage-number.headshot {
  color: #ef4444;
  font-size: 1.8rem;
}
@keyframes floatUp {
  0% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-50px); }
}
#game-over-screen {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(2, 6, 23, 0.95);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 200;
}
.game-over-title {
  font-size: 3rem;
  font-weight: 900;
  margin-bottom: 1rem;
}
.game-over-title.victory {
  color: #22c55e;
}
.game-over-title.defeat {
  color: #ef4444;
}
.game-over-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 2rem;
  margin: 2rem 0;
}
.stat-box {
  text-align: center;
}
.stat-value {
  font-size: 2.5rem;
  font-weight: 900;
  color: white;
}
.stat-label {
  color: #94a3b8;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 1px;
}
#restart-btn {
  margin-top: 2rem;
  padding: 1rem 3rem;
  font-size: 1.2rem;
  font-weight: 700;
  background: #60a5fa;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  pointer-events: auto;
}
#restart-btn:hover {
  background: #3b82f6;
  transform: scale(1.05);
}
#vignette {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background: radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.6) 100%);
}
#damage-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background: radial-gradient(circle at center, transparent 0%, rgba(239, 68, 68, 0.3) 100%);
  opacity: 0;
  transition: opacity 0.1s ease;
}
#notification-area {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  pointer-events: none;
}
.notification {
  font-size: 2rem;
  font-weight: 900;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  animation: notificationAnim 2s ease-out forwards;
}
.notification.kill {
  color: #ef4444;
}
.notification.objective {
  color: #22c55e;
}
.notification.bomb {
  color: #f59e0b;
}
@keyframes notificationAnim {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  50% { opacity: 1; transform: translateY(-20px) scale(1.1); }
  100% { opacity: 0; transform: translateY(-40px) scale(1); }
}
.site-footer {
  background: rgba(2,6,23,0.95);
  border-top: 1px solid #1e293b;
  padding: 3rem 1rem;
  position: relative;
  z-index: 10;
}
.footer-inner {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 1.5rem;
}
.footer-nav {
  display: flex;
  gap: 1.5rem;
  flex-wrap: wrap;
}
.footer-nav a {
  color: #cbd5e1;
  text-decoration: none;
}
.footer-nav a:hover {
  color: #60a5fa;
}
.site-footer p {
  margin: 0;
  color: #94a3b8;
}
</style>
</head>
<body>
<header class="site-header">
  <div class="header-inner">
    <div class="header-left">
      <div class="logo"><a href="index.html">BowesProduct</a></div>
      <nav class="main-nav">
        <a href="index.html">Home</a>
        <a href="models.html">Models</a>
        <a href="retexture.html">Retexture</a>
        <a href="fps-game.html" style="color:#60a5fa;">Game</a>
      </nav>
    </div>
    <div class="header-right">
      <img id="profilePic" alt="Profile">
      <div id="levelInfo">
        <div id="levelText"></div>
        <div id="xpOuter"><div id="xpBar"></div></div>
      </div>
      <button id="authBtn" class="login-btn">Login</button>
    </div>
  </div>
</header>
<div id="game-container">
  <canvas id="game-canvas"></canvas>
  <div id="start-screen">
    <div class="start-content">
      <h1 class="game-title">TACTICAL BREACH</h1>
      <p class="game-subtitle">Rainbow Six Siege Style FPS</p>
      <p class="start-hint">Click to Start Breaching</p>
     
      <div class="controls-grid">
        <div class="control-item">
          <span class="control-key">WASD</span>
          <span class="control-desc">Move</span>
        </div>
        <div class="control-item">
          <span class="control-key">MOUSE</span>
          <span class="control-desc">Aim &amp; Shoot</span>
        </div>
        <div class="control-item">
          <span class="control-key">SHIFT</span>
          <span class="control-desc">Sprint</span>
        </div>
        <div class="control-item">
          <span class="control-key">SPACE</span>
          <span class="control-desc">Jump</span>
        </div>
        <div class="control-item">
          <span class="control-key">CTRL</span>
          <span class="control-desc">Crouch</span>
        </div>
        <div class="control-item">
          <span class="control-key">Q/E</span>
          <span class="control-desc">Lean Left/Right</span>
        </div>
        <div class="control-item">
          <span class="control-key">R</span>
          <span class="control-desc">Reload</span>
        </div>
        <div class="control-item">
          <span class="control-key">F</span>
          <span class="control-desc">Plant Bomb</span>
        </div>
        <div class="control-item">
          <span class="control-key">G</span>
          <span class="control-desc">Grenade</span>
        </div>
        <div class="control-item">
          <span class="control-key">T</span>
          <span class="control-desc">Flashlight</span>
        </div>
      </div>
    </div>
  </div>
  <div id="hud">
    <div id="crosshair">
      <div class="crosshair-dot"></div>
      <div class="crosshair-line crosshair-top"></div>
      <div class="crosshair-line crosshair-bottom"></div>
      <div class="crosshair-line crosshair-left"></div>
      <div class="crosshair-line crosshair-right"></div>
    </div>
    <div id="hitmarker">
      <div class="hitmarker-line hitmarker-tl"></div>
      <div class="hitmarker-line hitmarker-tr"></div>
      <div class="hitmarker-line hitmarker-bl"></div>
      <div class="hitmarker-line hitmarker-br"></div>
    </div>
    <div id="health-bar-container">
      <div class="health-bar-label">Health</div>
      <div class="health-bar-bg">
        <div id="health-fill" class="health-bar-fill"></div>
      </div>
      <div id="health-text">100</div>
    </div>
    <div id="ammo-display">
      <div class="ammo-label">Ammo</div>
      <div><span id="ammo-current">30</span> / <span id="ammo-max">120</span></div>
    </div>
    <div id="objective-panel">
      <div class="objective-title">Objective</div>
      <div id="objective-text">Eliminate all enemies or plant the bomb</div>
      <div id="bomb-timer">00:00</div>
    </div>
    <div id="score-panel">
      <div class="score-item">
        <div class="score-label">Kills</div>
        <div id="kills-value" class="score-value">0</div>
      </div>
    </div>
    <div id="minimap">
      <canvas id="minimap-canvas"></canvas>
    </div>
    <div id="vignette"></div>
    <div id="damage-overlay"></div>
    <div id="notification-area"></div>
  </div>
  <div id="game-over-screen">
    <h1 id="game-over-title" class="game-over-title">VICTORY</h1>
    <div class="game-over-stats">
      <div class="stat-box">
        <div id="final-kills" class="stat-value">0</div>
        <div class="stat-label">Kills</div>
      </div>
      <div class="stat-box">
        <div id="final-time" class="stat-value">00:00</div>
        <div class="stat-label">Time</div>
      </div>
      <div class="stat-box">
        <div id="final-score" class="stat-value">0</div>
        <div class="stat-label">Score</div>
      </div>
    </div>
    <button id="restart-btn">Breach Again</button>
  </div>
</div>
<footer class="site-footer">
  <div class="footer-inner">
    <nav class="footer-nav">
      <a href="about.html">About</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="license.html">License</a>
      <a href="refund.html">Refund</a>
      <a href="rewards.html">Rewards</a>
    </nav>
    <p>© 2025 BowesProduct</p>
  </div>
</footer>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyB4JMVBMcWcN2wKsaVYmnggHH5ue1mUfaA",
  authDomain: "bowesproduct.firebaseapp.com",
  projectId: "bowesproduct"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();
const authBtn = document.getElementById("authBtn");
const profilePic = document.getElementById("profilePic");
const levelInfo = document.getElementById("levelInfo");
const levelText = document.getElementById("levelText");
const xpBar = document.getElementById("xpBar");
authBtn.onclick = () =>
  auth.currentUser ? signOut(auth) : signInWithPopup(auth, provider);
let currentUser = null;
onAuthStateChanged(auth, async (user) => {
 if (!user) {
  authBtn.textContent = "Login";
  profilePic.style.display = "none";
  levelInfo.style.display = "none";
  currentUser = null;
  return;
 }
 currentUser = user;
 authBtn.textContent = "Logout";
 profilePic.src = user.photoURL || "";
 profilePic.style.display = "block";
 const ref = doc(db, "users", user.uid);
 let snap = await getDoc(ref);
 if (!snap.exists()) {
  await setDoc(ref, { xp: 10, gamesPlayed: 0, totalKills: 0, wins: 0 });
  snap = await getDoc(ref);
 }
 const xp = snap.data().xp || 0;
 const levels = [0, 200, 500, 1000, 2000, 3500, 5000, 7500, 10000];
 let level = levels.filter(v => xp >= v).length - 1;
 let next = levels[level + 1] ?? levels[level];
 let progress = next === levels[level] ? 100 :
  ((xp - levels[level]) / (next - levels[level])) * 100;
 levelText.textContent = `Level ${level} • ${xp} XP`;
 xpBar.style.width = progress + "%";
 levelInfo.style.display = "block";
});
async function updateGameStats(kills, win) {
  if (!currentUser) return;
 
  const ref = doc(db, "users", currentUser.uid);
  const snap = await getDoc(ref);
  if (snap.exists()) {
    const data = snap.data();
    const xpGain = kills * 50 + (win ? 100 : 25);
    await updateDoc(ref, {
      xp: (data.xp || 0) + xpGain,
      gamesPlayed: (data.gamesPlayed || 0) + 1,
      totalKills: (data.totalKills || 0) + kills,
      wins: (data.wins || 0) + (win ? 1 : 0)
    });
  }
}
window.updateGameStats = updateGameStats;
</script>
<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.168.0';
import { PointerLockControls } from 'https://cdn.skypack.dev/three@0.168.0/examples/jsm/controls/PointerLockControls.js';
const GameState = {
  MENU: 'menu',
  PLAYING: 'playing',
  PAUSED: 'paused',
  GAMEOVER: 'gameover'
};
let currentState = GameState.MENU;
class AudioManager {
  constructor() {
    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    this.masterGain = this.audioContext.createGain();
    this.masterGain.gain.value = 0.3;
    this.masterGain.connect(this.audioContext.destination);
  }
  playGunshot() {
    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();
    oscillator.type = 'sawtooth';
    oscillator.frequency.setValueAtTime(150, this.audioContext.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.1);
    gainNode.gain.setValueAtTime(0.5, this.audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
    oscillator.connect(gainNode);
    gainNode.connect(this.masterGain);
    oscillator.start();
    oscillator.stop(this.audioContext.currentTime + 0.2);
  }
  playExplosion() {
    const bufferSize = this.audioContext.sampleRate * 0.5;
    const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / bufferSize, 2);
    }
    const source = this.audioContext.createBufferSource();
    source.buffer = buffer;
    const gainNode = this.audioContext.createGain();
    gainNode.gain.setValueAtTime(0.8, this.audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
    source.connect(gainNode);
    gainNode.connect(this.masterGain);
    source.start();
  }
  playHitSound() {
    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
    gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.05);
    oscillator.connect(gainNode);
    gainNode.connect(this.masterGain);
    oscillator.start();
    oscillator.stop(this.audioContext.currentTime + 0.05);
  }
  playDeathSound() {
    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();
    oscillator.type = 'triangle';
    oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.3);
    gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
    oscillator.connect(gainNode);
    gainNode.connect(this.masterGain);
    oscillator.start();
    oscillator.stop(this.audioContext.currentTime + 0.3);
  }
  playObjectiveComplete() {
    const notes = [523.25, 659.25, 783.99];
    notes.forEach((freq, index) => {
      const oscillator = this.audioContext.createOscillator();
      const gainNode = this.audioContext.createGain();
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(freq, this.audioContext.currentTime + index * 0.15);
      gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime + index * 0.15);
      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + index * 0.15 + 0.3);
      oscillator.connect(gainNode);
      gainNode.connect(this.masterGain);
      oscillator.start(this.audioContext.currentTime + index * 0.15);
      oscillator.stop(this.audioContext.currentTime + index * 0.15 + 0.3);
    });
  }
  playBombPlant() {
    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime);
    gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
    oscillator.connect(gainNode);
    gainNode.connect(this.masterGain);
    oscillator.start();
    oscillator.stop(this.audioContext.currentTime + 0.5);
  }
  playBombBeep() {
    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(880, this.audioContext.currentTime);
    gainNode.gain.setValueAtTime(0.15, this.audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
    oscillator.connect(gainNode);
    gainNode.connect(this.masterGain);
    oscillator.start();
    oscillator.stop(this.audioContext.currentTime + 0.1);
  }
}
class ParticleSystem {
  constructor(scene) {
    this.scene = scene;
    this.particles = [];
  }
  createMuzzleFlash(position) {
    const flashGeometry = new THREE.SphereGeometry(0.1, 8, 8);
    const flashMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00, transparent: true, opacity: 1 });
    const flash = new THREE.Mesh(flashGeometry, flashMaterial);
    flash.position.copy(position);
    this.scene.add(flash);
    this.particles.push({ mesh: flash, life: 0.1, maxLife: 0.1, type: 'muzzleFlash' });
  }
  createBloodSplatter(position, count = 10) {
    for (let i = 0; i < count; i++) {
      const geometry = new THREE.SphereGeometry(0.03, 4, 4);
      const material = new THREE.MeshBasicMaterial({ color: 0xff0000, transparent: true, opacity: 1 });
      const particle = new THREE.Mesh(geometry, material);
      particle.position.copy(position);
      const velocity = new THREE.Vector3((Math.random() - 0.5) * 2, Math.random() * 2, (Math.random() - 0.5) * 2);
      this.scene.add(particle);
      this.particles.push({ mesh: particle, velocity: velocity, life: 0.5, maxLife: 0.5, type: 'blood' });
    }
  }
  createDebris(position, color, count = 15) {
    for (let i = 0; i < count; i++) {
      const size = Math.random() * 0.05 + 0.02;
      const geometry = new THREE.BoxGeometry(size, size, size);
      const material = new THREE.MeshBasicMaterial({ color: color, transparent: true, opacity: 1 });
      const particle = new THREE.Mesh(geometry, material);
      particle.position.copy(position);
      particle.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
      const velocity = new THREE.Vector3((Math.random() - 0.5) * 3, Math.random() * 3, (Math.random() - 0.5) * 3);
      const angularVelocity = new THREE.Vector3((Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10);
      this.scene.add(particle);
      this.particles.push({ mesh: particle, velocity: velocity, angularVelocity: angularVelocity, life: 1, maxLife: 1, type: 'debris' });
    }
  }
  createExplosion(position) {
    const explosionGeometry = new THREE.SphereGeometry(1, 16, 16);
    const explosionMaterial = new THREE.MeshBasicMaterial({ color: 0xff4500, transparent: true, opacity: 1 });
    const explosion = new THREE.Mesh(explosionGeometry, explosionMaterial);
    explosion.position.copy(position);
    this.scene.add(explosion);
    this.particles.push({ mesh: explosion, life: 0.3, maxLife: 0.3, type: 'explosion' });
    this.createDebris(position, 0x8B4513, 30);
    this.createDebris(position, 0x696969, 20);
  }
  update(deltaTime) {
    for (let i = this.particles.length - 1; i >= 0; i--) {
      const particle = this.particles[i];
      particle.life -= deltaTime;
      if (particle.life <= 0) {
        this.scene.remove(particle.mesh);
        this.particles.splice(i, 1);
        continue;
      }
      const lifeRatio = particle.life / particle.maxLife;
      particle.mesh.material.opacity = lifeRatio;
      if (particle.velocity) {
        particle.mesh.position.add(particle.velocity.clone().multiplyScalar(deltaTime));
        particle.velocity.y -= 9.8 * deltaTime;
      }
      if (particle.angularVelocity) {
        particle.mesh.rotation.x += particle.angularVelocity.x * deltaTime;
        particle.mesh.rotation.y += particle.angularVelocity.y * deltaTime;
        particle.mesh.rotation.z += particle.angularVelocity.z * deltaTime;
      }
      if (particle.type === 'muzzleFlash') {
        particle.mesh.scale.setScalar(1 + (1 - lifeRatio) * 2);
      } else if (particle.type === 'explosion') {
        particle.mesh.scale.setScalar(1 + (1 - lifeRatio
