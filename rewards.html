<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rewards â€“ BowesProduct</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*,*::before,*::after{box-sizing:border-box}
html,body{
  margin:0;
  background:#020617;
  color:#fff;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif
}
.site-header{position:sticky;top:0;z-index:1000;background:#020617;border-bottom:1px solid #1e293b}
.header-inner{max-width:1200px;margin:auto;padding:.6rem 1rem;display:flex;justify-content:space-between;align-items:center}
.logo a{color:#fff;font-weight:700;text-decoration:none}
.main-nav a{color:#cbd5e1;margin-right:1rem;text-decoration:none}
.main-nav a:hover{color:#60a5fa}
.header-right{display:flex;align-items:center;gap:.8rem}
#profilePic{width:32px;height:32px;border-radius:50%;display:none;border:2px solid #60a5fa}
.login-btn{border:1.5px solid #60a5fa;color:#60a5fa;background:none;border-radius:999px;padding:.45rem 1.1rem;cursor:pointer}
#levelInfo{display:none;font-size:.8rem;width:140px}
#xpOuter{background:#1e293b;height:5px;border-radius:3px}
#xpBar{background:#60a5fa;height:100%;width:0%;transition:.3s}

.page{max-width:1100px;margin:4rem auto;padding:0 1.5rem}
h1{color:#60a5fa}

.progress-track{background:#1e293b;height:10px;border-radius:6px}
#xpProgress,#shareProgressBar{background:#60a5fa;height:100%;width:0%;border-radius:6px;transition:.4s}

.share-section{margin-top:3rem;background:#1e293b66;padding:1.5rem;border-radius:16px;text-align:center}

.rewards-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.5rem;margin-top:3rem}
.reward-card{border:1px solid #1e293b;border-radius:16px;padding:1.5rem;text-align:center}
.reward-card.locked{opacity:.4}
.claim-btn{margin-top:.8rem;border:none;border-radius:999px;padding:.45rem 1.2rem;background:#60a5fa;color:#020617;cursor:pointer}
.claim-btn:disabled{background:#1e293b;color:#64748b;cursor:not-allowed}

.site-footer{margin-top:5rem;border-top:1px solid #1e293b;padding:2.5rem 1rem}
.footer-inner{max-width:1200px;margin:auto;display:flex;justify-content:space-between;flex-wrap:wrap;gap:1.5rem}
.footer-nav a{color:#cbd5e1;text-decoration:none;margin-right:1rem}
.footer-nav a:hover{color:#60a5fa}
</style>
</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <div class="logo"><a href="index.html">BowesProduct</a></div>
    <nav class="main-nav">
      <a href="index.html">Home</a>
      <a href="models.html">Models</a>
    </nav>
    <div class="header-right">
      <img id="profilePic">
      <div id="levelInfo">
        <div id="levelText"></div>
        <div id="xpOuter"><div id="xpBar"></div></div>
      </div>
      <button id="authBtn" class="login-btn">Login</button>
    </div>
  </div>
</header>

<div class="page">
  <h1>Your Rewards</h1>
  <p id="currentLevelText">Log in to see your rewards.</p>

  <div class="progress-track"><div id="xpProgress"></div></div>
  <p id="xpText" style="color:#94a3b8"></p>

  <div class="share-section" id="shareSection" style="display:none">
    <h2>Daily Sharing Rewards</h2>
    <div class="progress-track"><div id="shareProgressBar"></div></div>
    <p>Shares today: <span id="shareCount">0</span> / 50</p>
  </div>

  <div id="rewardsGrid" class="rewards-grid"></div>
</div>

<footer class="site-footer">
  <div class="footer-inner">
    <nav class="footer-nav">
      <a href="about.html">About</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="license.html">License</a>
      <a href="refund.html">Refund</a>
      <a href="rewards.html">Rewards</a>
    </nav>
    <p>Â© 2025 BowesProduct</p>
  </div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyB4JMVBMcWcN2wKsaVYmnggHH5ue1mUfaA",
  authDomain:"bowesproduct.firebaseapp.com",
  projectId:"bowesproduct"
});

const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const LEVELS=[0,200,500,1000,2000,4000];
const TITLES=["Starter","Explorer","Builder","Artist","Creator","Master"];
const SHARE_CAP=50;
const TODAY=new Date().toDateString();

const authBtn=document.getElementById("authBtn");
authBtn.onclick=()=>auth.currentUser?signOut(auth):signInWithPopup(auth,provider);

onAuthStateChanged(auth,async user=>{
  if(!user)return;

  const ref=doc(db,"users",user.uid);
  let snap=await getDoc(ref);
  if(!snap.exists()){
    await setDoc(ref,{xp:10,dailyShares:0,lastShareDate:TODAY});
    snap=await getDoc(ref);
  }

  let data=snap.data();

  if(data.lastShareDate!==TODAY){
    await updateDoc(ref,{dailyShares:0,lastShareDate:TODAY});
    data.dailyShares=0;
  }

  const xp=data.xp||0;
  const shares=data.dailyShares||0;
  const level=LEVELS.filter(v=>xp>=v).length-1;
  const next=LEVELS[level+1]??LEVELS[level];
  const progress=next===LEVELS[level]?100:((xp-LEVELS[level])/(next-LEVELS[level]))*100;

  document.getElementById("levelText").textContent=`Level ${level} â€¢ ${xp} XP`;
  document.getElementById("xpBar").style.width=progress+"%";
  document.getElementById("xpProgress").style.width=progress+"%";
  document.getElementById("xpText").textContent=`${xp} XP`;
  document.getElementById("currentLevelText").textContent=`Level ${level} â€“ ${TITLES[level]}`;
  document.getElementById("shareCount").textContent=shares;
  document.getElementById("shareProgressBar").style.width=(shares/SHARE_CAP)*100+"%";
  document.getElementById("shareSection").style.display="block";

  const grid=document.getElementById("rewardsGrid");
  grid.innerHTML="";
  [
    {lvl:1,icon:"ðŸ“¦",t:"Free Pack"},
    {lvl:2,icon:"ðŸŽŸï¸",t:"15% Off"},
    {lvl:3,icon:"ðŸ—¿",t:"Free Model"},
    {lvl:4,icon:"âœ¨",t:"Exclusive"},
    {lvl:5,icon:"ðŸ‘‘",t:"Permanent 20%"}
  ].forEach(r=>{
    const c=document.createElement("div");
    c.className="reward-card"+(level>=r.lvl?"":" locked");
    c.innerHTML=`<div style="font-size:2rem">${r.icon}</div><h3>${r.t}</h3>
      <button class="claim-btn" ${level>=r.lvl?"":"disabled"}>Claim</button>`;
    grid.appendChild(c);
  });
});

window.addEventListener("storage",e=>{
  if(e.key==="rewardsUpdated")location.reload();
});
</script>

</body>
</html>
