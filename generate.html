<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Generate and Create 3D Models with Meshy API.">
  <title>Generate or Create â€“ BowesProduct</title>

  <style>
    body {
      background-color: #020617;
      color: white;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
    }

    .header {
      background-color: rgba(2, 6, 23, 0.95);
      padding: 1rem 2rem;
      text-align: center;
      border-bottom: 1px solid #1e293b;
    }

    .header h1 {
      color: #60a5fa;
      margin: 0;
    }

    .content {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1.5rem;
      text-align: center;
    }

    .generate-btn {
      background-color: #2563eb;
      color: white;
      padding: 1rem 2rem;
      font-size: 1.1rem;
      cursor: pointer;
      border-radius: 8px;
      margin: 20px 0;
    }

    .generate-btn:hover {
      background-color: #1d4ed8;
    }

    .output {
      background-color: #1e293b;
      padding: 2rem;
      margin-top: 2rem;
      border-radius: 8px;
    }

    .model-preview {
      width: 100%;
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      border: 1px solid #60a5fa;
      display: block;
      margin: 0 auto;
    }

    .login-btn {
      background-color: #60a5fa;
      color: white;
      padding: 1rem 2rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <h1>Generate or Create 3D Model</h1>
  </header>

  <!-- CONTENT -->
  <div class="content">
    <button id="generateBtn" class="generate-btn" disabled>Generate 3D Model</button>

    <div id="output" class="output" style="display: none;">
      <h2>Generated 3D Model:</h2>
      <img id="modelPreview" class="model-preview" alt="3D Model Preview" />
      <p>Model generated successfully! You can now download or use it in your project.</p>
    </div>

    <!-- Firebase Login Section -->
    <button id="loginBtn" class="login-btn">Login with Google</button>
    <button id="logoutBtn" class="login-btn" style="display: none;">Logout</button>
  </div>

  <!-- Firebase & Meshy API Script -->
  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB4JMVBMcWcN2wKsaVYmnggHH5ue1mUfaA", // Replace with your own API key
      authDomain: "bowesproduct.firebaseapp.com",
      projectId: "bowesproduct"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const db = getFirestore(app);

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const generateBtn = document.getElementById("generateBtn");
    const profilePic = document.getElementById("profilePic");

    loginBtn.addEventListener('click', () => {
      signInWithPopup(auth, provider);
    });

    logoutBtn.addEventListener('click', () => {
      signOut(auth);
    });

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        generateBtn.disabled = false; // Enable the generate button after login
      } else {
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        generateBtn.disabled = true; // Disable the generate button if not logged in
      }
    });

    // Meshy API Integration
    const API_KEY = 'msy_v1UeJLbZ1CNLgsfWoG8vHoy8RsoEO0nVchy5';
    const API_URL = 'https://api.meshy.ai/v1/generate/model';

    generateBtn.addEventListener('click', async () => {
      try {
        // Ensure user is logged in before generating model
        const user = auth.currentUser;
        if (!user) {
          alert('Please log in to generate a model.');
          return;
        }

        // Request data from Meshy API
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model_type: 'character',
            style: 'realistic',
            format: 'obj',
            color: 'blue',
            quality: 'high',
            features: ['human', 'clothing', 'armor']
          })
        });

        const data = await response.json();

        if (response.ok && data.model_url) {
          // Display model preview
          document.getElementById('modelPreview').src = data.model_url;
          document.getElementById('output').style.display = 'block';
        } else {
          throw new Error('Failed to generate model');
        }

      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while generating the 3D model. Please try again.');
      }
    });
  </script>

</body>
</html>
